!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(t,e,n,r){var i;for(i=0;i<r&&!(i+n>=e.length||i>=t.length);i++)e[i+n]=t[i];return i}function i(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s=t[i],a=null,u=s>239?4:s>223?3:s>191?2:1;if(i+u<=n){var c=void 0,f=void 0,h=void 0,l=void 0;switch(u){case 1:s<128&&(a=s);break;case 2:c=t[i+1],128===(192&c)&&(l=(31&s)<<6|63&c,l>127&&(a=l));break;case 3:c=t[i+1],f=t[i+2],128===(192&c)&&128===(192&f)&&(l=(15&s)<<12|(63&c)<<6|63&f,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:c=t[i+1],f=t[i+2],h=t[i+3],128===(192&c)&&128===(192&f)&&128===(192&h)&&(l=(15&s)<<18|(63&c)<<12|(63&f)<<6|63&h,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,u=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=u}return o(r)}function o(t){var e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=O));return n}function s(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],s=0;s<r;s++){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function a(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;i++)r+=String.fromCharCode(127&t[i]);return r}function u(t,e){e.flags=[0],t.__proto__=Uint8Array.prototype,t.utf8Write=function(t,e,n){return r(s(t,this.length-e),this,e,n)},t.utf8Slice=function(t,e){return i(this,t,e)},t.asciiSlice=function(t,e){return a(this,t,e)},t.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;i--)t[i+e]=this[i+n];else for(i=0;i<o;i++)t[i+e]=this[i+n];return o}}function c(t,e){console.log("TODO: createFromString")}function f(t){console.log("TODO: createFromArrayBuffer")}function h(t,e){console.log("TODO: compare")}function l(t){return s(t).length}function p(t,e,n){console.log("TODO: indexOfString")}function d(t,e,n){console.log("TODO: indexOfBuffer")}function y(t,e,n){console.log("TODO: indexOfNumber")}function g(t,e,n,r){console.log("TODO: fill")}function w(t,e){console.log("TODO: readFloatLE")}function v(t,e){console.log("TODO: readFloatBE")}function E(t,e){console.log("TODO: readDoubleLE")}function m(t,e){console.log("TODO: readDoubleBE")}function S(t,e,n){console.log("TODO: writeFloatLE")}function I(t,e,n){console.log("TODO: writeFloatBE")}function b(t,e,n){console.log("TODO: writeDoubleLE")}function _(t,e,n){console.log("TODO: writeDoubleBE")}n.kMaxLength=1073741823,n.utf8Slice=i;var O=4096;n.utf8ToBytes=s,n.setupBufferJS=u,n.createFromString=c,n.createFromArrayBuffer=f,n.compare=h,n.byteLengthUtf8=l,n.indexOfString=p,n.indexOfBuffer=d,n.indexOfNumber=y,n.fill=g,n.readFloatLE=w,n.readFloatBE=v,n.readDoubleLE=E,n.readDoubleBE=m,n.writeFloatLE=S,n.writeFloatBE=I,n.writeDoubleLE=b,n.writeDoubleBE=_},{}],2:[function(t,e,n){"use strict";n.E2BIG=7,n.EACCES=13,n.EADDRINUSE=98,n.EADDRNOTAVAIL=99,n.EAFNOSUPPORT=97,n.EAGAIN=11,n.EALREADY=114,n.EBADF=9,n.EBADMSG=74,n.EBUSY=16,n.ECANCELED=125,n.ECHILD=10,n.ECONNABORTED=103,n.ECONNREFUSED=111,n.ECONNRESET=104,n.EDEADLK=35,n.EDESTADDRREQ=89,n.EDOM=33,n.EDQUOT=122,n.EEXIST=17,n.EFAULT=14,n.EFBIG=27,n.EHOSTUNREACH=113,n.EIDRM=43,n.EILSEQ=84,n.EINPROGRESS=115,n.EINTR=4,n.EINVAL=22,n.EIO=5,n.EISCONN=106,n.EISDIR=21,n.ELOOP=40,n.EMFILE=24,n.EMLINK=31,n.EMSGSIZE=90,n.EMULTIHOP=72,n.ENAMETOOLONG=36,n.ENETDOWN=100,n.ENETRESET=102,n.ENETUNREACH=101,n.ENFILE=23,n.ENOBUFS=105,n.ENODATA=61,n.ENODEV=19,n.ENOENT=2,n.ENOEXEC=8,n.ENOLCK=37,n.ENOLINK=67,n.ENOMEM=12,n.ENOMSG=42,n.ENOPROTOOPT=92,n.ENOSPC=28,n.ENOSR=63,n.ENOSTR=60,n.ENOSYS=38,n.ENOTCONN=107,n.ENOTDIR=20,n.ENOTEMPTY=39,n.ENOTSOCK=88,n.ENOTSUP=95,n.ENOTTY=25,n.ENXIO=6,n.EOPNOTSUPP=95,n.EOVERFLOW=75,n.EPERM=1,n.EPIPE=32,n.EPROTO=71,n.EPROTONOSUPPORT=93,n.EPROTOTYPE=91,n.ERANGE=34,n.EROFS=30,n.ESPIPE=29,n.ESRCH=3,n.ESTALE=116,n.ETIME=62,n.ETIMEDOUT=110,n.ETXTBSY=26,n.EWOULDBLOCK=11,n.EXDEV=18,n.F_OK=0,n.O_APPEND=1024,n.O_CREAT=64,n.O_DIRECT=16384,n.O_DIRECTORY=65536,n.O_EXCL=128,n.O_NOCTTY=256,n.O_NOFOLLOW=131072,n.O_NONBLOCK=2048,n.O_RDONLY=0,n.O_RDWR=2,n.O_SYNC=1052672,n.O_TRUNC=512,n.O_WRONLY=1,n.R_OK=4,n.SIGABRT=6,n.SIGALRM=14,n.SIGBUS=7,n.SIGCHLD=17,n.SIGCONT=18,n.SIGFPE=8,n.SIGHUP=1,n.SIGILL=4,n.SIGINT=2,n.SIGIO=29,n.SIGIOT=6,n.SIGKILL=9,n.SIGPIPE=13,n.SIGPOLL=29,n.SIGPROF=27,n.SIGPWR=30,n.SIGQUIT=3,n.SIGSEGV=11,n.SIGSTKFLT=16,n.SIGSTOP=19,n.SIGSYS=31,n.SIGTERM=15,n.SIGTRAP=5,n.SIGTSTP=20,n.SIGTTIN=21,n.SIGTTOU=22,n.SIGUNUSED=31,n.SIGURG=23,n.SIGUSR1=10,n.SIGUSR2=12,n.SIGVTALRM=26,n.SIGWINCH=28,n.SIGXCPU=24,n.SIGXFSZ=25,n.S_IFBLK=24576,n.S_IFCHR=8192,n.S_IFDIR=16384,n.S_IFIFO=4096,n.S_IFLNK=40960,n.S_IFMT=61440,n.S_IFREG=32768,n.S_IFSOCK=49152,n.S_IRGRP=32,n.S_IROTH=4,n.S_IRUSR=256,n.S_IRWXG=56,n.S_IRWXO=7,n.S_IRWXU=448,n.S_IWGRP=16,n.S_IWOTH=2,n.S_IWUSR=128,n.S_IXGRP=8,n.S_IXOTH=1,n.S_IXUSR=64,n.UV_UDP_REUSEADDR=4,n.W_OK=2,n.X_OK=1},{}],3:[function(t,e,n){"use strict";var r=t("node-binary-marshal"),i=t("./constants"),o=0,s=1,a=function(){function t(t,e){this.kernel=t,this.fd=e,this.refCount=1}return t.prototype.write=function(t,e){var n=Array.prototype.slice.apply(arguments);this.kernel.fs.write.apply(this.kernel.fs,[this.fd].concat(n))},t.prototype.read=function(t,e,n,r,i){this.kernel.fs.read(this.fd,t,e,n,r,i)},t.prototype.stat=function(t){this.kernel.fs.fstat(this.fd,t)},t.prototype.readdir=function(t){setTimeout(t,0,"cant readdir on normal file")},t.prototype.llseek=function(t,e,n,r){n===s?this.fd._pos+=e:n===o&&(this.fd._pos=e),r(0,this.fd._pos)},t.prototype.ref=function(){this.refCount++},t.prototype.unref=function(){this.refCount--,this.refCount||(this.kernel.fs.close(this.fd),this.fd=void 0)},t}();n.RegularFile=a;var u=function(){function t(t,e){this.kernel=t,this.path=e,this.off=0,this.refCount=1}return t.prototype.write=function(t,e){setTimeout(e,0,"cant write to a dir")},t.prototype.read=function(t,e,n,r,i){setTimeout(i,0,"cant read from a dir -- use readdir")},t.prototype.stat=function(t){this.kernel.fs.stat(this.path,t)},t.prototype.readdir=function(t){this.kernel.fs.readdir(this.path,t)},t.prototype.llseek=function(t,e,n,r){console.log("TODO: dir.llseek"),r(0,0)},t.prototype.getdents=function(t,e){var n=this;this.readdir(function(o,s){if(o)return console.log("readdir: "+o),void e(-i.EFAULT,null);s=s.slice(n.off);for(var a=s.map(function(t){return new r.fs.Dirent((-1),r.fs.DT.UNKNOWN,t)}),u=new Uint8Array(t),c=new DataView(u.buffer),f=0,h=0;h<a.length;h++){var l=a[h];if(f+l.reclen>t)break;var p=r.Marshal(c,f,l,r.fs.DirentDef),d=p[0],y=p[1];if(y)return console.log("dirent marshal failed: "+y),void e(-i.EFAULT,null);f+=d,n.off++}e(null,u.slice(0,f))})},t.prototype.ref=function(){this.refCount++},t.prototype.unref=function(){this.refCount--,this.refCount||(this.path=void 0)},t}();n.DirFile=u},{"./constants":2,"node-binary-marshal":36}],4:[function(t,e,n){function r(t){this.type=t,this.state=t+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1}n.HTTPParser=r,r.REQUEST="REQUEST",r.RESPONSE="RESPONSE";var i=r.kOnHeaders=0,o=r.kOnHeadersComplete=1,s=r.kOnBody=2,a=r.kOnMessageComplete=3,u=!0;Object.defineProperty(r,"kOnExecute",{get:function(){return u=!1,4}});var c=r.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR"];r.prototype.reinitialize=r,r.prototype.close=r.prototype.pause=r.prototype.resume=function(){},r.prototype._compatMode0_11=!1;var f=81920,h={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};r.prototype.execute=function(t,e,n){if(!(this instanceof r))throw new TypeError("not a HTTPParser");e=e||0,n="number"==typeof n?n:t.length,this.chunk=t,this.offset=e;var i=this.end=e+n;try{for(;this.offset<i&&!this[this.state](););}catch(o){if(this.isUserCall)throw o;return o}this.chunk=null;var n=this.offset-e;return h[this.state]&&(this.headerSize+=n,this.headerSize>f)?new Error("max header size exceeded"):n};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};r.prototype.finish=function(){return l[this.state]?void("BODY_RAW"===this.state&&this.userCall()(this[a]())):new Error("invalid state for EOF")},r.prototype.consume=r.prototype.unconsume=r.prototype.getCurrentBuffer=function(){},r.prototype.userCall=function(){this.isUserCall=!0;var t=this;return function(e){return t.isUserCall=!1,e}},r.prototype.nextRequest=function(){this.userCall()(this[a]()),this.reinitialize(this.type)},r.prototype.consumeLine=function(){for(var t=this.end,e=this.chunk,n=this.offset;n<t;n++)if(10===e.readUInt8(n)){var r=this.line+e.toString("ascii",this.offset,n);return"\r"===r.charAt(r.length-1)&&(r=r.substr(0,r.length-1)),this.line="",this.offset=n+1,r}this.line+=e.toString("ascii",this.offset,this.end),this.offset=this.end};var p=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,d=/^[ \t]+(.*[^ \t])/;r.prototype.parseHeader=function(t,e){var n=p.exec(t),r=n&&n[1];if(r)e.push(r),e.push(n[2]);else{var i=d.exec(t);i&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=i[1])}};var y=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;r.prototype.REQUEST_LINE=function(){var t=this.consumeLine();if(t){var e=y.exec(t);if(null===e){var n=new Error("Parse Error");throw n.code="HPE_INVALID_CONSTANT",n}if(this.info.method=this._compatMode0_11?e[1]:c.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");"CONNECT"===e[1]&&(this.info.upgrade=!0),this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var g=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;r.prototype.RESPONSE_LINE=function(){var t=this.consumeLine();if(t){var e=g.exec(t);if(null===e){var n=new Error("Parse Error");throw n.code="HPE_INVALID_CONSTANT",n}this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var r=this.info.statusCode=+e[3];this.info.statusMessage=e[4],1!==(r/100|0)&&204!==r&&304!==r||(this.body_bytes=0),this.state="HEADER"}},r.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!(null===this.body_bytes&&!this.isChunked)},r.prototype.HEADER=function(){var t=this.consumeLine();if(void 0!==t){var e=this.info;if(t)this.parseHeader(t,e.headers);else{for(var n=e.headers,r=0;r<n.length;r+=2)switch(n[r].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===n[r+1].toLowerCase();break;case"content-length":this.body_bytes=+n[r+1];break;case"connection":this.connection+=n[r+1].toLowerCase();break;case"upgrade":e.upgrade=!0}e.shouldKeepAlive=this.shouldKeepAlive();var i;if(i=u?this.userCall()(this[o](e)):this.userCall()(this[o](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),e.upgrade)return this.nextRequest(),!0;this.isChunked&&!i?this.state="BODY_CHUNKHEAD":i||0===this.body_bytes?this.nextRequest():null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}},r.prototype.BODY_CHUNKHEAD=function(){var t=this.consumeLine();void 0!==t&&(this.body_bytes=parseInt(t,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},r.prototype.BODY_CHUNK=function(){var t=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[s](this.chunk,this.offset,t)),this.offset+=t,this.body_bytes-=t,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},r.prototype.BODY_CHUNKEMPTYLINE=function(){var t=this.consumeLine();void 0!==t&&(this.state="BODY_CHUNKHEAD")},r.prototype.BODY_CHUNKTRAILERS=function(){var t=this.consumeLine();void 0!==t&&(t?this.parseHeader(t,this.trailers):(this.trailers.length&&this.userCall()(this[i](this.trailers,"")),this.nextRequest()))},r.prototype.BODY_RAW=function(){var t=this.end-this.offset;this.userCall()(this[s](this.chunk,this.offset,t)),this.offset=this.end},r.prototype.BODY_SIZED=function(){var t=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[s](this.chunk,this.offset,t)),this.offset+=t,this.body_bytes-=t,this.body_bytes||this.nextRequest()}},{}],5:[function(t,e,n){(function(e){"use strict";function r(t,e){return t+"/"+e}function i(t){if("number"!=typeof t)return t;switch(t&V&&console.log("TODO: nonblocking flag"),t&=~(j|K|W|V)){case x:return"r";case X:return"w";case x|H:return"rs";case M:return"r+";case M|H:return"rs+";case z|P|X:return"w";case z|P|X|B:return"wx";case z|P|M:return"w+";case z|P|M|B:return"wx+";case C|P|X:return"a";case C|P|X|B:return"ax";case C|P|M:return"a+";case C|P|M|B:return"ax+"}throw new Error("Unknown file open flag: "+t)}function o(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function s(t,e,n,r){function i(t,e){if(e)return void n(e,void 0);y.initialize(t);var i=u.require("fs"),o=new Z(i,s,r);window.kernel=o,setImmediate(n,null,o)}var o=this;r||(r={});var s=1,u={};y.install(u),a=u.Buffer,window.Buffer=a;var c=y.FileSystem[t];if(!c)return void setImmediate(n,"unknown FileSystem type: "+t);var f=new(Function.prototype.bind.apply(c,[null].concat(e)));if(r.readOnly)f.initialize?f.initialize(i.bind(this,f)):i(f,null);else{var h=new y.FileSystem.InMemory,l=new y.FileSystem.AsyncMirrorFS(h,f);l.initialize(function(t){if(t)return void n(t,void 0);var e=new y.FileSystem.InMemory,r=new y.FileSystem.OverlayFS(e,l);r.initialize(i.bind(o,r))})}}var a,u=this,c=t("./constants"),f=t("./pipe"),h=t("./socket"),l=t("./file"),p=t("./types"),d=t("./http_parser"),y=t("./vendor/BrowserFS/src/core/browserfs"),g=t("node-binary-marshal"),w=t("../browser-node/binding/buffer"),v=!1;if(t("./vendor/BrowserFS/src/backend/in_memory"),t("./vendor/BrowserFS/src/backend/XmlHttpRequest"),t("./vendor/BrowserFS/src/backend/overlay"),t("./vendor/BrowserFS/src/backend/async_mirror"),"undefined"==typeof setImmediate){var E=e,m=[],S="zero-timeout-message",I=function(){if("undefined"!=typeof E.importScripts||!E.postMessage)return!1;var t=!0,e=E.onmessage;return E.onmessage=function(){t=!1},E.postMessage("","*"),E.onmessage=e,t};if(I()){E.setImmediate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push([t,e]),E.postMessage(S,"*")};var b=function(t){if(t.source===self&&t.data===S&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0),m.length>0){var e=m.shift(),n=e[0],r=e[1];return n.apply(u,r)}};E.addEventListener("message",b,!0)}else E.setImmediate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return setTimeout.apply(u,[t,0].concat(e))}}if("undefined"==typeof window||"undefined"==typeof window.Worker)var _=t("webworker-threads").Worker;else var _=window.Worker;var O=25,T=c.ENOENT,N=c.EACCES,F=c.F_OK,U=c.R_OK,L=c.W_OK,D=c.X_OK,k=c.S_IRUSR,A=c.S_IWUSR,R=c.S_IXUSR,C=c.O_APPEND||0,P=c.O_CREAT||0,B=c.O_EXCL||0,x=c.O_RDONLY||0,M=c.O_RDWR||0,H=c.O_SYNC||0,z=c.O_TRUNC||0,X=c.O_WRONLY||0,V=c.O_NONBLOCK||0,W=c.O_DIRECTORY||0,Y=-20,G=20,j=524288,K=32768;!function(t){t[t.UNSPEC=0]="UNSPEC",t[t.LOCAL=1]="LOCAL",t[t.UNIX=1]="UNIX",t[t.FILE=1]="FILE",t[t.INET=2]="INET",t[t.INET6=10]="INET6"}(n.AF||(n.AF={}));var q=n.AF;!function(t){t[t.STREAM=1]="STREAM",t[t.DGRAM=2]="DGRAM"}(n.SOCK||(n.SOCK={}));var Q=n.SOCK,J=function(){function t(t){this.kernel=t}return t.prototype.getcwd=function(t){t.complete(w.utf8ToBytes(t.task.cwd))},t.prototype.fork=function(t,e,n){this.kernel.fork(t,t.task,e,n)},t.prototype.exit=function(t,e){e||(e=0),this.kernel.exit(t.task,e)},t.prototype.chdir=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,t.task.chdir(n,function(e){t.complete(e)})},t.prototype.wait4=function(t,e,n){t.task.wait4(t,e,n)},t.prototype.getpid=function(t){t.complete(null,t.task.pid)},t.prototype.getppid=function(t){t.complete(null,t.task.parent?t.task.parent.pid:0)},t.prototype.getdents=function(t,e,n){var r=t.task.files[e];if(!r)return void t.complete(-c.EBADF,null);r instanceof l.DirFile||t.complete(-c.ENOTDIR,null);var i=r;i.getdents(n,t.complete.bind(t))},t.prototype.llseek=function(t,e,n,r,i){var o=t.task.files[e];return o?void o.llseek(n,r,i,function(e,n){t.complete(e,n)}):void t.complete(-c.EBADF,void 0)},t.prototype.socket=function(t,e,n,r){if(e===q.UNSPEC&&(e=q.INET),e!==q.INET&&n!==Q.STREAM)return t.complete("unsupported socket type");var i=new h.SocketFile(t.task),o=t.task.addFile(i);t.complete(void 0,o)},t.prototype.bind=function(t,e,n){var r={},i=new DataView(n.buffer,n.byteOffset),o=g.Unmarshal(r,i,0,g.socket.SockAddrInDef),s=(o[0],o[1],r.addr),a=r.port;0===a&&(console.log("port was zero -- changing to 8080"),a=8080);var u=t.task.files[e];return u?h.isSocket(u)?void t.complete(this.kernel.bind(u,s,a)):t.complete("ENOTSOCKET"):void t.complete("bad FD "+e,null)},t.prototype.getsockname=function(t,e){console.log("TODO: getsockname");var n={family:Q.STREAM,port:8080,addr:"127.0.0.1"},r=new Uint8Array(g.socket.SockAddrInDef.length),i=new DataView(r.buffer,r.byteOffset);return g.Marshal(i,0,n,g.socket.SockAddrInDef),t.complete(null,r)},t.prototype.listen=function(t,e,n){var r=this,i=t.task.files[e];return i?h.isSocket(i)?void i.listen(function(e){if(t.complete(e),!e){var n=r.kernel.portWaiters[i.port];n&&(delete r.kernel.portWaiters[i.port],n(i.port))}}):t.complete("ENOTSOCKET"):void t.complete("bad FD "+e,null)},t.prototype.accept=function(t,e){var n=t.task.files[e];return n?h.isSocket(n)?void n.accept(function(e,n,r,i){if(e)return t.complete(e);var o=t.task.addFile(n);"localhost"===r&&(r="127.0.0.1");var s=new Uint8Array(g.socket.SockAddrInDef.length),a=new DataView(s.buffer,s.byteOffset);g.Marshal(a,0,{family:2,port:i,addr:r},g.socket.SockAddrInDef),t.complete(void 0,o,s)}):t.complete("ENOTSOCKET"):void t.complete("bad FD "+e,null)},t.prototype.connect=function(t,e,n){var r={},i=new DataView(n.buffer,n.byteOffset),o=g.Unmarshal(r,i,0,g.socket.SockAddrInDef),s=(o[0],o[1],r.addr),a=r.port,u=t.task.files[e];return u?h.isSocket(u)?void u.connect(s,a,function(e){t.complete(e)}):t.complete("ENOTSOCKET"):void t.complete("bad FD "+e,null)},t.prototype.spawn=function(t,e,n,r,i,o){function s(t){if("string"==typeof t)return t;if(t instanceof Uint8Array||t instanceof Array){var e=t.length;return e>0&&0===t[e-1]&&e--,w.utf8Slice(t,0,e)}return console.log("unreachable"),""}var a=s(e),u=s(n),c=r.map(function(t){return s(t)}),f=i.map(function(t){return s(t)});this.kernel.spawn(t.task,a,u,c,f,o,function(e,n){t.complete(e,n)})},t.prototype.pread=function(t,e,n,r){var i=t.task.files[e];if(!i)return void t.complete("bad FD "+e,null);if(i instanceof f.Pipe)return void i.read(t,n);r===-1&&(r=null);var o=new a(n);i.read(o,0,n,r,function(e,n){return e?(console.log(e),void t.complete(e,null)):void t.complete(null,n,new Uint8Array(o.data.buff.buffer,0,n))})},t.prototype.pwrite=function(t,e,n){var r=t.task.files[e];if(!r)return void t.complete("bad FD "+e,null);if(!(n instanceof a)&&n instanceof Uint8Array){var i=n,o=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);return n=new a(o),void r.write(n,0,n.length,function(e,n){t.complete(e,n)})}r.write(n,function(e,n){t.complete(e,n)})},t.prototype.pipe2=function(t,e){var n=new f.Pipe,r=t.task.addFile(new f.PipeFile(n)),i=t.task.addFile(new f.PipeFile(n));t.complete(void 0,r,i)},t.prototype.getpriority=function(t,e,n){return 0!==e&&0!==n?void t.complete("NOT_IMPLEMENTED",-1):void t.complete(void 0,t.task.priority)},t.prototype.setpriority=function(t,e,n,r){return 0!==e&&0!==n?void t.complete("NOT_IMPLEMENTED",-1):void t.complete(void 0,t.task.setPriority(r))},t.prototype.readdir=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.readdir(r(t.task.cwd,n),t.complete.bind(t))},t.prototype.open=function(t,e,n,o){var s,a=this;s=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,s=r(t.task.cwd,s),this.kernel.fs.open(s,i(n),o,function(e,n){var r;if(e&&"EISDIR"===e.code)r=new l.DirFile(a.kernel,s);else{if(e)return void t.complete(e,null);r=new l.RegularFile(a.kernel,n)}var i=t.task.addFile(r);t.complete(void 0,i)})},t.prototype.unlink=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.unlink(r(t.task.cwd,n),t.complete.bind(t))},t.prototype.utimes=function(t,e,n,i){var o;o=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e;var s=new Date(1e3*n),a=new Date(1e3*i);this.kernel.fs.utimes(r(t.task.cwd,o),s,a,t.complete.bind(t))},t.prototype.futimes=function(t,e,n,r){var i=t.task.files[e];if(!i)return void t.complete("bad FD "+e,null);if(i instanceof f.Pipe)return void t.complete("TODO: futimes on pipe?");var o=new Date(1e3*n),s=new Date(1e3*r);this.kernel.fs.futimes(i,o,s,t.complete.bind(t))},t.prototype.rmdir=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.rmdir(r(t.task.cwd,n),t.complete.bind(t))},t.prototype.mkdir=function(t,e,n){var i;i=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.mkdir(r(t.task.cwd,i),n,t.complete.bind(t))},t.prototype.close=function(t,e){var n=t.task.files[e];return n?e<=2?void t.complete(null,0):(t.task.files[e]=void 0,n instanceof f.Pipe?(t.complete(null,0),void n.unref()):(n.unref(),void t.complete(null,0))):void t.complete("bad FD "+e,null)},t.prototype.fstat=function(t,e){var n=t.task.files[e];return n?void n.stat(function(e,n){if(e)return void t.complete(e,null);var r=new Uint8Array(g.fs.StatDef.length),i=new DataView(r.buffer,r.byteOffset);g.Marshal(i,0,n,g.fs.StatDef),t.complete(null,r)}):void t.complete("bad FD "+e,null)},t.prototype.access=function(t,e,n){var i;i=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.stat(r(t.task.cwd,i),function(e,r){if(e)return void t.complete(-T);if(n===F)return void t.complete(F);var i=0;n&U&&!(r.mode&k)&&(i=-N),n&L&&!(r.mode&A)&&(i=-N),n&D&&!(r.mode&R)&&(i=-N),t.complete(i)})},t.prototype.lstat=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.lstat(r(t.task.cwd,n),function(e,n){if(e)return void t.complete(e,null);var r=new Uint8Array(g.fs.StatDef.length),i=new DataView(r.buffer,r.byteOffset);g.Marshal(i,0,n,g.fs.StatDef),t.complete(null,r)})},t.prototype.stat=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.stat(r(t.task.cwd,n),function(e,n){if(e)return void t.complete(e,null);var r=new Uint8Array(g.fs.StatDef.length),i=new DataView(r.buffer,r.byteOffset);g.Marshal(i,0,n,g.fs.StatDef),t.complete(null,r)})},t.prototype.readlink=function(t,e){var n;n=e instanceof Uint8Array?w.utf8Slice(e,0,e.length):e,this.kernel.fs.readlink(r(t.task.cwd,e),function(e,n){return e?void t.complete(e,null):void t.complete(null,w.utf8ToBytes(n))})},t.prototype.ioctl=function(t,e,n,r){t.complete(O,null)},t}(),Z=function(){function t(t,e,n){this.debug=v,this.portWaiters={},this.ports={},this.tasks={},this.taskIdSeq=0,this.outstanding=0,this.nCPUs=e,this.fs=t,this.syscalls=new J(this),this.runQueues=[];for(var r=Y;r<G;r++)this.runQueues[r-Y]=[]}return t.prototype.once=function(t,e){var n=t.split(":");if(2!==n.length||"port"!==n[0])return"only supported event is currently port";var r=parseInt(n[1],10);return r>=1&&r<32768?void(this.portWaiters[r]=e):"invalid port: "+r},t.prototype.system=function(t,e,n,r,i){var o,s=this;o=t.indexOf("|")>-1||t.indexOf("&")>-1?["/usr/bin/sh",t]:t.split(" ").filter(function(t){return""!==t}),"/"!==o[0][0]&&"."!==o[0][0]&&(o[0]="/usr/bin/"+o[0]);var a=["PWD=/","GOPATH=/","USER=browsix","PATH=/usr/bin","LANG=en_US.UTF-8","LC_ALL=en_US.UTF-8","HOME=/"].concat(i||[]);console.log(o),this.spawn(null,"/",o[0],o,a,null,function(t,i){if(t){var a=-666;return"ENOENT"===t.code&&(a=-c.ENOENT,r(-1,o[0]+": command not found\n")),void e(-1,a)}var u=s.tasks[i];u.onExit=e;var f=u.files[1],h=u.files[2];f.addEventListener("write",n),h.addEventListener("write",r)})},t.prototype.httpRequest=function(t,e){function n(t,e){return t?void console.log("http read error: "+t):(l.execute(y.slice(0,e)),void(e>0&&(y=new a(65536),f.read(y,0,65536,0,n))))}var r=80,i=t.split("://")[1].split("/"),o=i[0];"/"+i.slice(1).join("/");if(o.indexOf(":")>-1){var s="";g=o.split(":"),o=g[0],s=g[1],r=parseInt(s,10)}var u="GET "+t+" HTTP/1.1\r\n";u+="Host: localhost:"+r+"\r\n",u+="User-Agent: Browsix/1.0\r\n",u+="Accept: */*\r\n\r\n";var c=[],f=new h.SocketFile(null),l=new d.HTTPParser(d.HTTPParser.RESPONSE),p=function(t){for(var e=t.toLowerCase(),n=0;n+1<l.info.headers.length;n+=2)if(l.info.headers[n].toLowerCase()===e)return l.info.headers[n+1];return""};l.isUserCall=!0,l[d.HTTPParser.kOnHeadersComplete]=function(t){},l[d.HTTPParser.kOnBody]=function(t,e,n){c.push(t.slice(e,e+n))},l[d.HTTPParser.kOnMessageComplete]=function(){console.log("TODO: close file object & socket");var t=p("Content-Type");t||(console.log("WARN: no content-type header"),t="text/plain");var n=a.concat(c),r=new Uint8Array(n.data.buff.buffer,0,n.length),i=new Blob([r],{type:t}),o={status:l.info.statusCode,response:i};e.apply(o,[])};var y=new a(65536);this.connect(f,o,r,function(t){return t?void console.log("connect failed: "+t):(console.log("connected to "+r),f.read(y,0,65536,0,n),void f.write(u,function(t,e){t&&console.log("err: "+t)}))});var g},t.prototype.wait=function(t){t in this.tasks&&this.tasks[t].state===$.Zombie?delete this.tasks[t]:console.log("wait called for bad pid "+t)},t.prototype.exit=function(t,e){return t.state===$.Zombie?void console.log("warning, got more than 1 exit call from "+t.pid):void t.exit(e)},t.prototype.kill=function(t){if(t in this.tasks){var e=this.tasks[t];this.exit(e,-666)}},t.prototype.unbind=function(t,e,n){if(n in this.ports)return t!==this.ports[n]?void console.log("unbind for wrong port?"):void delete this.ports[n]},t.prototype.bind=function(t,e,n){return n in this.ports?"port "+n+" already bound":(this.ports[n]=t,t.port=n,void(t.addr=e))},t.prototype.connect=function(t,e,n,r){if("localhost"!==e&&"127.0.0.1"!==e)return r("TODO: only localhost connections for now");if(!(n in this.ports))return r("unknown port");var i=this.ports[n];if(!i.isListening)return r("remote not listening");var o=t;i.doAccept(o,e,n,r)},t.prototype.doSyscall=function(t){t.name in this.syscalls?this.syscalls[t.name].apply(this.syscalls,t.callArgs()):console.log("unknown syscall "+t.name)},t.prototype.spawn=function(t,e,n,r,i,o,s){var a=this.nextTaskId();i=i||[];for(var u={},c=0;c<i.length;c++){var h=i[c],l=h.search("=");if(!(l<0)){var p=h.substring(0,l),d=h.substring(l+1);u[p]=d}}var y=[];if(o&&t)for(var c=0;c<o.length;c++){var g=o[c];if(!(g in t.files)){console.log("spawn: tried to use bad fd "+g);break}y[c]=t.files[g],y[c].ref()}else y[0]=new f.PipeFile,y[1]=new f.PipeFile,y[2]=new f.PipeFile;var w=new tt(this,t,a,"/",n,r,u,y,null,null,null,s);this.tasks[a]=w},t.prototype.fork=function(t,e,n,r){var i=this.nextTaskId(),s=e.cwd,a=e.exePath,u=e.args,c=e.env,f=o(e.files);for(var h in f)f.hasOwnProperty(h)&&f[h]&&f[h].ref();var l=e.blobUrl,p=new tt(this,e,i,s,a,u,c,f,l,n,r,function(e,n){e&&(console.log("fork failed in kernel: "+e),t.complete(-1)),t.complete(n)});this.tasks[i]=p},t.prototype.nextTaskId=function(){return++this.taskIdSeq},t}();n.Kernel=Z,function(t){t[t.Starting=0]="Starting",t[t.Running=1]="Running",t[t.Interruptable=2]="Interruptable",t[t.Zombie=3]="Zombie"}(n.TaskState||(n.TaskState={}));var $=n.TaskState,tt=function(){function t(t,e,n,r,i,o,s,a,u,c,f,h){this.files={},this.waitQueue=[],this.children=[],this.msgIdSeq=1,this.state=$.Starting,this.pid=n,this.parent=e,this.kernel=t,this.exePath=i,this.exeFd=null,this.args=o,this.cwd=r,this.priority=0,e&&(this.priority=e.priority,this.parent.children.push(this)),this.env=s,this.files=a,this.blobUrl=u,this.heap=c,this.forkArgs=f,this.onRunnable=h,u?this.blobReady(u):t.fs.open(i,"r",this.fileOpened.bind(this))}return t.prototype.chdir=function(t,e){var n=this;t.length||e(-c.ENOENT),"/"!==t[0]&&(t=r(this.cwd,t)),this.kernel.fs.stat(t,function(r,i){return r?void e(-N):i.isDirectory()?(n.cwd=t,void e(0)):void e(-c.ENOTDIR)})},t.prototype.addFile=function(t){var e=Object.keys(this.files).length;return this.files[e]=t,e},t.prototype.fileOpened=function(t,e){var n=this;return t?(this.onRunnable(t,void 0),void this.exit(-1)):(this.exeFd=e,void this.kernel.fs.fstat(e,function(t,r){if(t)return n.onRunnable(t,void 0),void n.exit(-1);var i=new a(r.size);n.kernel.fs.read(e,i,0,r.size,0,n.fileRead.bind(n))}))},t.prototype.fileRead=function(t,e,n){if(t)return this.onRunnable(t,void 0),void this.exit(-1);if(e>2&&35===n.readUInt8(0)&&33===n.readUInt8(1)){var r=n.indexOf("\n");if(r<0)throw new Error("shebang with no newline: "+n);var i=n.slice(2,r).toString();n=n.slice(r+1);var o=i.match(/\S+/g),s=o[0];return 2!==o.length||"/usr/bin/env"!==o[0]&&"/bin/env"!==o[0]||(s="/usr/bin/"+o[1]),this.args[0]=this.exePath,this.args=[s].concat(this.args),void this.kernel.fs.open(s,"r",this.fileOpened.bind(this))}var a=new Uint8Array(n.data.buff.buffer),u=new Blob([a],{type:"text/javascript"});a=void 0;var c=window.URL.createObjectURL(u);this.blobUrl=c,this.blobReady(c)},t.prototype.blobReady=function(t){var e=this;this.worker=new _(t),this.worker.onmessage=this.syscallHandler.bind(this),this.worker.onerror=function(t){e.files[2]?e.files[2].write("Error while executing "+e.exePath+": "+t.message+"\n",function(){e.kernel.exit(e,-1)}):e.kernel.exit(e,-1)};var n=this.heap,r=this.forkArgs;this.heap=void 0,this.forkArgs=void 0,this.signal("init",[this.args,this.env,this.kernel.debug,this.pid,n,r],n?[n]:null),this.onRunnable(null,this.pid),this.onRunnable=void 0},t.prototype.setPriority=function(t){return this.priority+=t,this.priority<Y&&(this.priority=Y),this.priority>=G&&(this.priority=G-1),0},t.prototype.wait4=function(t,e,n){e<-1&&(console.log("TODO: wait4 with pid < -1"),t.complete(-c.ECHILD)),n&&console.log("TODO: non-zero options");for(var r=0;r<this.children.length;r++){var i=this.children[r];if(e===-1||0===e||i.pid===e){if(i.state!==$.Zombie)return void this.waitQueue.push([t,e,n]);var o=0;return t.complete(i.pid,o,null),this.kernel.wait(i.pid),void this.children.splice(r,1)}}t.complete(-c.ECHILD)},t.prototype.childDied=function(t,e){if(!this.waitQueue.length)return void this.signal("child",[t,e,0]);var n=this.waitQueue;this.waitQueue=[];for(var r=0;r<n.length;r++)this.wait4.apply(this,n[r]);this.signal("child",[t,e,0])},t.prototype.signal=function(t,e,n){this.schedule({id:-1,name:t,args:e},n)},t.prototype.schedule=function(t,e){this.state!==$.Zombie&&(this.state=$.Running,this.worker.postMessage(t,e||[]))},t.prototype.exit=function(t){this.state=$.Zombie,this.exitCode=t,this.onRunnable=void 0,this.blobUrl=void 0;for(var e in this.files)this.files.hasOwnProperty(e)&&this.files[e]&&(this.files[e].unref(),
this.files[e]=void 0);this.worker&&(this.worker.onmessage=void 0,this.worker.terminate(),this.worker=void 0);for(var n=0;n<this.children.length;n++){var r=this.children[n];r.parent=this.parent,r.parent||r.state!==$.Zombie||this.kernel.wait(r.pid)}this.parent&&this.parent.childDied(this.pid,t),this.onExit&&this.onExit(this.pid,this.exitCode),this.parent||this.kernel.wait(this.pid)},t.prototype.nextMsgId=function(){return++this.msgIdSeq},t.prototype.syscallHandler=function(t){var e=p.Syscall.From(this,t);return e?void(this.state!==$.Zombie&&(this.state=$.Interruptable,this.kernel.doSyscall(e))):void console.log("bad syscall message, dropping")},t}();n.Task=tt,n.Boot=s,"undefined"!=typeof window&&(window.Boot=s)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../browser-node/binding/buffer":1,"./constants":2,"./file":3,"./http_parser":4,"./pipe":6,"./socket":7,"./types":8,"./vendor/BrowserFS/src/backend/XmlHttpRequest":9,"./vendor/BrowserFS/src/backend/async_mirror":10,"./vendor/BrowserFS/src/backend/in_memory":11,"./vendor/BrowserFS/src/backend/overlay":12,"./vendor/BrowserFS/src/core/browserfs":14,"node-binary-marshal":36,"webworker-threads":void 0}],6:[function(t,e,n){"use strict";function r(t){return t instanceof s}var i=t("./constants"),o=function(){function t(){this.buf=new Buffer(0),this.refcount=1,this.waiter=void 0,this.closed=!1}return t.prototype.write=function(t){var e=new Buffer(t);return this.writeBuffer(e)},t.prototype.writeBuffer=function(t){if(this.buf=Buffer.concat([this.buf,t]),this.waiter){var e=this.waiter;this.waiter=void 0,e()}return t.length},t.prototype.read=function(t,e,n,r,i){var o=this;if(this.buf.length||this.closed){var s=this.buf.copy(t,r,e,e+n);return this.buf.length===e+s?this.buf=new Buffer(0):this.buf=this.buf.slice(e+s),i(void 0,s)}this.waiter=function(){var s=o.buf.copy(t,r,e,e+n);o.buf.length===e+s?o.buf=new Buffer(0):o.buf=o.buf.slice(e+s),i(void 0,s)}},t.prototype.readSync=function(){return this.buf},t.prototype.ref=function(){this.refcount++},t.prototype.unref=function(){this.refcount--,this.refcount||(this.closed=!0,this.waiter&&(this.waiter(),this.waiter=void 0))},t}();n.Pipe=o,n.isPipe=r;var s=function(){function t(t){t||(t=new o),this.pipe=t}return t.prototype.addEventListener=function(t,e){return"write"!==t?void console.log("eventListener only available on PipeFile for write"):void(this.writeListener=e)},t.prototype.write=function(t,e){"string"==typeof t?this.pipe.write(t):this.pipe.writeBuffer(t),e=arguments[arguments.length-1],e(void 0,t.length),this.writeListener&&("string"==typeof t?this.writeListener(-1,t):this.writeListener(-1,t.toString("utf-8")))},t.prototype.read=function(t,e,n,r,i){this.pipe.read(t,e,n,r,i)},t.prototype.stat=function(t){throw new Error("TODO: PipeFile.stat not implemented")},t.prototype.llseek=function(t,e,n,r){r(-i.EINVAL,void 0)},t.prototype.readdir=function(t){setTimeout(t,0,"cant readdir on normal file")},t.prototype.readSync=function(){return this.pipe.readSync()},t.prototype.ref=function(){this.pipe.ref()},t.prototype.unref=function(){this.pipe.unref()},t}();n.PipeFile=s},{"./constants":2}],7:[function(t,e,n){"use strict";function r(t){return t instanceof s}var i=t("./constants"),o=t("./pipe");n.isSocket=r;var s=function(){function t(t){this.isListening=!1,this.parent=void 0,this.refCount=1,this.outgoing=void 0,this.incoming=void 0,this.incomingQueue=[],this.acceptQueue=[],this.task=t}return t.prototype.stat=function(t){throw new Error("TODO: SocketFile.stat not implemented")},t.prototype.readdir=function(t){setTimeout(t,0,"cant readdir on normal file")},t.prototype.listen=function(t){this.isListening=!0,t(void 0)},t.prototype.accept=function(e){if(!this.incomingQueue.length)return void this.acceptQueue.push(e);var n=this.incomingQueue.shift(),r=n.s,i=new t(this.task),s=new o.Pipe,a=new o.Pipe;i.outgoing=s,r.incoming=s,i.incoming=a,r.outgoing=a,e(null,i,n.addr,n.port),n.cb(null)},t.prototype.doAccept=function(e,n,r,i){if(!this.acceptQueue.length)return void this.incomingQueue.push({s:e,addr:n,port:r,cb:i});var s=this.acceptQueue.shift(),a=new t(this.task),u=new o.Pipe,c=new o.Pipe;a.outgoing=u,e.incoming=u,a.incoming=c,e.outgoing=c,s(null,a,n,r),i(null)},t.prototype.connect=function(t,e,n){this.task.kernel.connect(this,t,e,n)},t.prototype.write=function(t,e){"string"==typeof t?this.outgoing.write(t):this.outgoing.writeBuffer(t),(e=arguments[arguments.length-1])(void 0,t.length)},t.prototype.read=function(t,e,n,r,i){this.incoming.read(t,e,n,r,i)},t.prototype.readSync=function(){return this.incoming.readSync()},t.prototype.llseek=function(t,e,n,r){r(-i.EINVAL,void 0)},t.prototype.ref=function(){this.refCount++,this.outgoing&&this.outgoing.ref(),this.incoming&&this.incoming.ref()},t.prototype.unref=function(){this.outgoing&&this.outgoing.unref(),this.incoming&&this.incoming.unref(),this.refCount--,this.refCount||this.port&&this.addr&&this.task.kernel.unbind(this,this.addr,this.port)},t}();n.SocketFile=s},{"./constants":2,"./pipe":6}],8:[function(t,e,n){"use strict";var r=function(){function t(t,e){this.task=t,this.id=e}return t.prototype.complete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.task.schedule({id:this.id,name:void 0,args:t})},t}();n.SyscallContext=r;var i=function(){function t(t,e,n){this.ctx=t,this.name=e,this.args=n}return t.From=function(e,n){if(n.data){for(var i=0;i<t.requiredOnData.length;i++)if(!n.data.hasOwnProperty(t.requiredOnData[i]))return;var o=new r(e,n.data.id);return new t(o,n.data.name,n.data.args)}},t.prototype.callArgs=function(){return[this.ctx].concat(this.args)},t.requiredOnData=["id","name","args"],t}();n.Syscall=i},{}],9:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("../core/file_system"),o=t("../generic/file_index"),s=t("../core/buffer"),a=t("../core/api_error"),u=t("../core/file_flag"),c=t("../generic/preload_file"),f=t("../core/browserfs"),h=t("../generic/xhr"),l=(s.Buffer,a.ApiError),p=a.ErrorCode,d=(u.FileFlag,u.ActionType),y=function(t){function e(e,n,r){void 0===n&&(n=""),void 0===r&&(r=!1),t.call(this),null==e&&(e="index.json"),n.length>0&&"/"!==n.charAt(n.length-1)&&(n+="/"),this.prefix_url=n;var i=this._requestFileSync(e,"json");if(null==i)throw new Error("Unable to find listing at URL: "+e);this._index=o.FileIndex.from_listing(i),this._asyncOnly=r}return r(e,t),e.prototype.empty=function(){this._index.fileIterator(function(t){t.file_data=null})},e.prototype.getXhrPath=function(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefix_url+t},e.prototype._requestFileSizeAsync=function(t,e){h.getFileSizeAsync(this.getXhrPath(t),e)},e.prototype._requestFileSizeSync=function(t){return h.getFileSizeSync(this.getXhrPath(t))},e.prototype._requestFileAsync=function(t,e,n){h.asyncDownloadFile(this.getXhrPath(t),e,n)},e.prototype._requestFileSync=function(t,e){return h.syncDownloadFile(this.getXhrPath(t),e)},e.prototype.getName=function(){return"XmlHttpRequest"},e.isAvailable=function(){return"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest},e.prototype.diskSpace=function(t,e){e(0,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!this._asyncOnly},e.prototype.preloadFile=function(t,e){var n=this._index.getInode(t);if(null===n)throw l.ENOENT(t);var r=n.getData();r.size=e.length,r.file_data=e},e.prototype.stat=function(t,e,n){var r=this._index.getInode(t);if(null===r)return n(l.ENOENT(t));var i;r.isFile()?(i=r.getData(),i.size<0?this._requestFileSizeAsync(t,function(t,e){return t?n(t):(i.size=e,void n(null,i.clone()))}):n(null,i.clone())):(i=r.getStats(),n(null,i))},e.prototype.statSync=function(t,e){var n=this._index.getInode(t);if(null===n)throw l.ENOENT(t);var r;return n.isFile()?(r=n.getData(),r.size<0&&(r.size=this._requestFileSizeSync(t))):r=n.getStats(),r},e.prototype.open=function(t,e,n,r){if(e.isWriteable())return r(new l(p.EPERM,t));var i=this,o=this._index.getInode(t);if(null===o)return r(l.ENOENT(t));if(o.isDir())return r(l.EISDIR(t));var s=o.getData();switch(e.pathExistsAction()){case d.THROW_EXCEPTION:case d.TRUNCATE_FILE:return r(l.EEXIST(t));case d.NOP:if(null!=s.file_data)return r(null,new c.NoSyncFile(i,t,e,s.clone(),s.file_data));this._requestFileAsync(t,"buffer",function(n,o){return n?r(n):(s.size=o.length,s.file_data=o,r(null,new c.NoSyncFile(i,t,e,s.clone(),o)))});break;default:return r(new l(p.EINVAL,"Invalid FileMode object."))}},e.prototype.openSync=function(t,e,n){if(e.isWriteable())throw new l(p.EPERM,t);var r=this._index.getInode(t);if(null===r)throw l.ENOENT(t);if(r.isDir())throw l.EISDIR(t);var i=r.getData();switch(e.pathExistsAction()){case d.THROW_EXCEPTION:case d.TRUNCATE_FILE:throw l.EEXIST(t);case d.NOP:if(null!=i.file_data)return new c.NoSyncFile(this,t,e,i.clone(),i.file_data);var o=this._requestFileSync(t,"buffer");return i.size=o.length,i.file_data=o,new c.NoSyncFile(this,t,e,i.clone(),o);default:throw new l(p.EINVAL,"Invalid FileMode object.")}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(n){e(n)}},e.prototype.readdirSync=function(t){var e=this._index.getInode(t);if(null===e)throw l.ENOENT(t);if(e.isFile())throw l.ENOTDIR(t);return e.getListing()},e.prototype.readFile=function(t,e,n,r){var i=r;this.open(t,n,420,function(t,n){if(t)return r(t);r=function(t,e){n.close(function(n){return null==t&&(t=n),i(t,e)})};var o=n,a=o.getBuffer();if(null===e)return a.length>0?r(t,a.sliceCopy()):r(t,new s.Buffer(0));try{r(null,a.toString(e))}catch(u){r(u)}})},e.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r,o=i.getBuffer();return null===e?o.length>0?o.sliceCopy():new s.Buffer(0):o.toString(e)}finally{r.closeSync()}},e}(i.BaseFileSystem);n.XmlHttpRequest=y,f.registerFileSystem("XmlHttpRequest",y)},{"../core/api_error":13,"../core/browserfs":14,"../core/buffer":15,"../core/file_flag":21,"../core/file_system":22,"../generic/file_index":30,"../generic/preload_file":33,"../generic/xhr":34}],10:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("../core/file_system"),o=t("../core/file_flag"),s=t("../generic/preload_file"),a=t("../core/browserfs"),u=t("../core/node_path"),c=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return r(e,t),e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(s.PreloadFile),f=function(t){function e(e,n){if(t.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._sync=e,this._async=n,!e.supportsSynch())throw new Error("Expected synchronous storage.");if(n.supportsSynch())throw new Error("Expected asynchronous storage.")}return r(e,t),e.prototype.getName=function(){return"AsyncMirror"},e.isAvailable=function(){return!0},e.prototype._syncSync=function(t){this._sync.writeFileSync(t.getPath(),t.getBuffer(),null,o.FileFlag.getFileFlag("w"),t.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[t.getPath(),t.getBuffer(),null,t.getFlag(),t.getStats().mode]})},e.prototype.initialize=function(t){var e=this;if(this._isInitialized)t();else{var n=function(t,n,r){"/"!==t&&e._sync.mkdirSync(t,n),e._async.readdir(t,function(e,n){function o(e){e?r(e):s<n.length?(i(u.join(t,n[s]),o),s++):r()}if(e)r(e);else{var s=0;o()}})},r=function(t,n,r){e._async.readFile(t,null,o.FileFlag.getFileFlag("r"),function(i,s){if(i)r(i);else try{e._sync.writeFileSync(t,s,null,o.FileFlag.getFileFlag("w"),n)}catch(a){i=a}finally{r(i)}})},i=function(t,i){e._async.stat(t,!1,function(e,o){e?i(e):o.isDirectory()?n(t,o.mode,i):r(t,o.mode,i)})};n("/",0,function(n){n?t(n):(e._isInitialized=!0,t())})}},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},e.prototype.enqueueOp=function(t){var e=this;if(this._queue.push(t),!this._queueRunning){this._queueRunning=!0;var n=function(t){if(t&&console.error("WARNING: File system has desynchronized. Received following error: "+t+"\n$"),e._queue.length>0){var r=e._queue.shift(),i=r.arguments;i.push(n),e._async[r.apiMethod].apply(e._async,i)}else e._queueRunning=!1};n()}},e.prototype.renameSync=function(t,e){this._sync.renameSync(t,e),this.enqueueOp({apiMethod:"rename",arguments:[t,e]})},e.prototype.statSync=function(t,e){return this._sync.statSync(t,e)},e.prototype.openSync=function(t,e,n){var r=this._sync.openSync(t,e,n);return r.closeSync(),new c(this,t,e,this._sync.statSync(t,!1),this._sync.readFileSync(t,null,o.FileFlag.getFileFlag("r")))},e.prototype.unlinkSync=function(t){this._sync.unlinkSync(t),this.enqueueOp({apiMethod:"unlink",arguments:[t]})},e.prototype.rmdirSync=function(t){this._sync.rmdirSync(t),this.enqueueOp({apiMethod:"rmdir",arguments:[t]})},e.prototype.mkdirSync=function(t,e){this._sync.mkdirSync(t,e),this.enqueueOp({apiMethod:"mkdir",arguments:[t,e]})},e.prototype.readdirSync=function(t){return this._sync.readdirSync(t)},e.prototype.existsSync=function(t){return this._sync.existsSync(t)},e.prototype.chmodSync=function(t,e,n){this._sync.chmodSync(t,e,n),this.enqueueOp({apiMethod:"chmod",arguments:[t,e,n]})},e.prototype.chownSync=function(t,e,n,r){this._sync.chownSync(t,e,n,r),this.enqueueOp({apiMethod:"chown",arguments:[t,e,n,r]})},e.prototype.utimesSync=function(t,e,n){this._sync.utimesSync(t,e,n),this.enqueueOp({apiMethod:"utimes",arguments:[t,e,n]})},e}(i.SynchronousFileSystem);a.registerFileSystem("AsyncMirrorFS",f),e.exports=f},{"../core/browserfs":14,"../core/file_flag":21,"../core/file_system":22,"../core/node_path":26,"../generic/preload_file":33}],11:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("../generic/key_value_filesystem"),o=t("../core/browserfs"),s=function(){function t(){this.store={}}return t.prototype.name=function(){return"In-memory"},t.prototype.clear=function(){this.store={}},t.prototype.beginTransaction=function(t){return new i.SimpleSyncRWTransaction(this)},t.prototype.get=function(t){return this.store[t]},t.prototype.put=function(t,e,n){return!(!n&&this.store.hasOwnProperty(t))&&(this.store[t]=e,!0)},t.prototype["delete"]=function(t){delete this.store[t]},t}();n.InMemoryStore=s;var a=function(t){function e(){t.call(this,{store:new s})}return r(e,t),e}(i.SyncKeyValueFileSystem);n.InMemoryFileSystem=a,o.registerFileSystem("InMemory",a)},{"../core/browserfs":14,"../generic/key_value_filesystem":32}],12:[function(t,e,n){function r(t){return 146|t}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=t("../core/file_system"),s=t("../core/buffer"),a=t("../core/api_error"),u=t("../core/file_flag"),c=t("../generic/preload_file"),f=t("../core/browserfs"),h=t("../core/node_path"),l=a.ApiError,p=s.Buffer,d=a.ErrorCode,y="/.deletedFiles.log",g=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return i(e,t),e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(c.PreloadFile),w=function(t){function e(e,n){if(t.call(this),this._isInitialized=!1,this._deletedFiles={},this._deleteLog=null,this._writable=e,this._readable=n,this._writable.isReadOnly())throw new l(d.EINVAL,"Writable file system must be writable.");if(!this._writable.supportsSynch()||!this._readable.supportsSynch())throw new l(d.EINVAL,"OverlayFS currently only operates on synchronous file systems.")}return i(e,t),e.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},e.prototype.createParentDirectories=function(t){for(var e=this,n=h.dirname(t),r=[];!this._writable.existsSync(n);)r.push(n),n=h.dirname(n);r=r.reverse(),r.forEach(function(t){e._writable.mkdirSync(t,e.statSync(t,!1).mode)})},e.isAvailable=function(){return!0},e.prototype._syncSync=function(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,u.FileFlag.getFileFlag("w"),t.getStats().mode)},e.prototype.getName=function(){return"OverlayFS"},e.prototype.initialize=function(t){var e=this;this._isInitialized?t():this._writable.readFile(y,"utf8",u.FileFlag.getFileFlag("r"),function(n,r){if(n){if(n.type!==d.ENOENT)return t(n)}else r.split("\n").forEach(function(t){e._deletedFiles[t.slice(1)]="d"===t.slice(0,1)});e._writable.open(y,u.FileFlag.getFileFlag("a"),420,function(n,r){n?t(n):(e._deleteLog=r,t())})})},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},e.prototype.deletePath=function(t){this._deletedFiles[t]=!0;var e=new p("d"+t+"\n");this._deleteLog.writeSync(e,0,e.length,null),this._deleteLog.syncSync()},e.prototype.undeletePath=function(t){if(this._deletedFiles[t]){this._deletedFiles[t]=!1;var e=new p("u"+t);this._deleteLog.writeSync(e,0,e.length,null),this._deleteLog.syncSync()}},e.prototype.renameSync=function(t,e){var n=this,r=this.statSync(t,!1);if(r.isDirectory()){if(t===e)return;var i=511;if(this.existsSync(e)){var o=this.statSync(e,!1),i=o.mode;if(!o.isDirectory())throw new l(d.ENOTDIR,"Path "+e+" is a file.");if(this.readdirSync(e).length>0)throw new l(d.ENOTEMPTY,"Path "+e+" not empty.")}this._writable.existsSync(t)?this._writable.renameSync(t,e):this._writable.existsSync(e)||this._writable.mkdirSync(e,i),this._readable.existsSync(t)&&this._readable.readdirSync(t).forEach(function(r){n.renameSync(h.resolve(t,r),h.resolve(e,r))})}else{if(this.existsSync(e)&&this.statSync(e,!1).isDirectory())throw new l(d.EISDIR,"Path "+e+" is a directory.");this.writeFileSync(e,this.readFileSync(t,null,u.FileFlag.getFileFlag("r")),null,u.FileFlag.getFileFlag("w"),r.mode)}t!==e&&this.existsSync(t)&&this.unlinkSync(t)},e.prototype.statSync=function(t,e){try{return this._writable.statSync(t,e)}catch(n){if(this._deletedFiles[t])throw new l(d.ENOENT,"Path "+t+" does not exist.");var i=this._readable.statSync(t,e).clone();return i.mode=r(i.mode),i}},e.prototype.openSync=function(t,e,n){if(this.existsSync(t))switch(e.pathExistsAction()){case u.ActionType.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);case u.ActionType.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,n);var r=this._readable.statSync(t,!1).clone();return r.mode=n,new g(this,t,e,r,this._readable.readFileSync(t,null,u.FileFlag.getFileFlag("r")));default:throw new l(d.EEXIST,"Path "+t+" exists.")}else switch(e.pathNotExistsAction()){case u.ActionType.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);default:throw new l(d.ENOENT,"Path "+t+" does not exist.")}},e.prototype.unlinkSync=function(t){if(!this.existsSync(t))throw new l(d.ENOENT,"Path "+t+" does not exist.");this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)},e.prototype.rmdirSync=function(t){if(!this.existsSync(t))throw new l(d.ENOENT,"Path "+t+" does not exist.");if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw new l(d.ENOTEMPTY,"Directory "+t+" is not empty.");this.deletePath(t)}},e.prototype.mkdirSync=function(t,e){if(this.existsSync(t))throw new l(d.EEXIST,"Path "+t+" already exists.");this.createParentDirectories(t),this._writable.mkdirSync(t,e)},e.prototype.readdirSync=function(t){var e=this,n=this.statSync(t,!1);if(!n.isDirectory())throw new l(d.ENOTDIR,"Path "+t+" is not a directory.");var r=[];try{r=r.concat(this._writable.readdirSync(t))}catch(i){}try{r=r.concat(this._readable.readdirSync(t))}catch(i){}var o={};return r.filter(function(n){var r=void 0===o[n]&&e._deletedFiles[t+"/"+n]!==!0;return o[n]=!0,r})},e.prototype.existsSync=function(t){return this._writable.existsSync(t)||this._readable.existsSync(t)&&this._deletedFiles[t]!==!0},e.prototype.chmodSync=function(t,e,n){var r=this;this.operateOnWritable(t,function(){r._writable.chmodSync(t,e,n)})},e.prototype.chownSync=function(t,e,n,r){var i=this;this.operateOnWritable(t,function(){i._writable.chownSync(t,e,n,r)})},e.prototype.utimesSync=function(t,e,n){var r=this;this.operateOnWritable(t,function(){r._writable.utimesSync(t,e,n)})},e.prototype.operateOnWritable=function(t,e){if(!this.existsSync(t))throw new l(d.ENOENT,"Path "+t+" does not exist.");this._writable.existsSync(t)||this.copyToWritable(t),e()},e.prototype.copyToWritable=function(t){var e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,u.FileFlag.getFileFlag("r")),null,u.FileFlag.getFileFlag("w"),this.statSync(t,!1).mode)},e}(o.SynchronousFileSystem);f.registerFileSystem("OverlayFS",w),e.exports=w},{"../core/api_error":13,"../core/browserfs":14,"../core/buffer":15,"../core/file_flag":21,"../core/file_system":22,"../core/node_path":26,"../generic/preload_file":33}],13:[function(t,e,n){var r=t("./buffer"),i=r.Buffer;!function(t){t[t.EPERM=0]="EPERM",t[t.ENOENT=1]="ENOENT",t[t.EIO=2]="EIO",t[t.EBADF=3]="EBADF",t[t.EACCES=4]="EACCES",t[t.EBUSY=5]="EBUSY",t[t.EEXIST=6]="EEXIST",t[t.ENOTDIR=7]="ENOTDIR",t[t.EISDIR=8]="EISDIR",t[t.EINVAL=9]="EINVAL",t[t.EFBIG=10]="EFBIG",t[t.ENOSPC=11]="ENOSPC",t[t.EROFS=12]="EROFS",t[t.ENOTEMPTY=13]="ENOTEMPTY",t[t.ENOTSUP=14]="ENOTSUP"}(n.ErrorCode||(n.ErrorCode={}));var o=n.ErrorCode,s={};s[o.EPERM]="Operation not permitted.",s[o.ENOENT]="No such file or directory.",s[o.EIO]="Input/output error.",s[o.EBADF]="Bad file descriptor.",s[o.EACCES]="Permission denied.",s[o.EBUSY]="Resource busy or locked.",s[o.EEXIST]="File exists.",s[o.ENOTDIR]="File is not a directory.",s[o.EISDIR]="File is a directory.",s[o.EINVAL]="Invalid argument.",s[o.EFBIG]="File is too big.",s[o.ENOSPC]="No space left on disk.",s[o.EROFS]="Cannot modify a read-only file system.",s[o.ENOTEMPTY]="Directory is not empty.",s[o.ENOTSUP]="Operation is not supported.";var a=function(){function t(t,e){this.type=t,this.code=o[t],null!=e?this.message=e:this.message=s[t]}return t.prototype.toString=function(){return this.code+": "+s[this.type]+" "+this.message},t.prototype.writeToBuffer=function(t,e){void 0===t&&(t=new i(this.bufferSize())),void 0===e&&(e=0),t.writeUInt8(this.type,e);var n=t.write(this.message,e+5);return t.writeUInt32LE(n,e+1),t},t.fromBuffer=function(e,n){return void 0===n&&(n=0),new t(e.readUInt8(n),e.toString("utf8",n+5,n+5+e.readUInt32LE(n+1)))},t.prototype.bufferSize=function(){return 5+i.byteLength(this.message)},t.FileError=function(e,n){return new t(e,n+": "+s[e])},t.ENOENT=function(t){return this.FileError(o.ENOENT,t)},t.EEXIST=function(t){return this.FileError(o.EEXIST,t)},t.EISDIR=function(t){return this.FileError(o.EISDIR,t)},t.ENOTDIR=function(t){return this.FileError(o.ENOTDIR,t)},t.EPERM=function(t){return this.FileError(o.EPERM,t)},t}();n.ApiError=a},{"./buffer":15}],14:[function(t,e,n){function r(t){t.Buffer=a.Buffer,t.process=c.process;var e=null!=t.require?t.require:null;t.require=function(t){var n=o(t);return null==n?e.apply(null,Array.prototype.slice.call(arguments,0)):n}}function i(t,e){n.FileSystem[t]=e}function o(t){switch(t){case"fs":return f.fs;case"path":return u;case"buffer":return a;case"process":return c.process;default:return n.FileSystem[t]}}function s(t){return f.fs._initialize(t)}var a=t("./buffer"),u=t("./node_path"),c=t("./node_process"),f=t("./node_fs");n.install=r,n.FileSystem={},n.registerFileSystem=i,n.BFSRequire=o,n.initialize=s},{"./buffer":15,"./node_fs":24,"./node_path":26,"./node_process":27}],15:[function(t,e,n){var r=t("./buffer_core"),i=t("./buffer_core_array"),o=t("./buffer_core_arraybuffer"),s=t("./buffer_core_imagedata"),a=t("./string_util"),u=[o.BufferCoreArrayBuffer,s.BufferCoreImageData,i.BufferCoreArray],c=function(){var t,e;for(t=0;t<u.length;t++)if(e=u[t],e.isAvailable())return e;throw new Error("This browser does not support any available BufferCore implementations.")}(),f=function(){function t(e,n,i){void 0===n&&(n="utf8"),this.offset=0;var s;if(!(this instanceof t))return new t(e,n);if(e instanceof r.BufferCoreCommon){this.data=e;var a="number"==typeof n?n:0,u="number"==typeof i?i:this.data.getLength();this.offset=a,this.length=u-a}else if("number"==typeof e){if(e!==e>>>0)throw new TypeError("Buffer size must be a uint32.");this.length=e,this.data=new c(e)}else if("undefined"!=typeof DataView&&e instanceof DataView)this.data=new o.BufferCoreArrayBuffer(e),this.length=e.byteLength;else if("undefined"!=typeof ArrayBuffer&&"number"==typeof e.byteLength)this.data=new o.BufferCoreArrayBuffer(e),this.length=e.byteLength;else if(e instanceof t){var f=e;this.data=new c(e.length),this.length=e.length,f.copy(this)}else if(Array.isArray(e)||null!=e&&"object"==typeof e&&"number"==typeof e[0]){for(this.data=new c(e.length),s=0;s<e.length;s++)this.data.writeUInt8(s,e[s]);this.length=e.length}else{if("string"!=typeof e)throw new Error("Invalid argument to Buffer constructor: "+e);this.length=t.byteLength(e,n),this.data=new c(this.length),this.write(e,0,this.length,n)}}return t.getAvailableBufferCores=function(){return u.filter(function(t){return t.isAvailable()})},t.getPreferredBufferCore=function(){return c},t.setPreferredBufferCore=function(t){c=t},t.prototype.getBufferCore=function(){return this.data},t.prototype.getOffset=function(){return this.offset},t.prototype.set=function(t,e){return e<0?this.writeInt8(e,t):this.writeUInt8(e,t)},t.prototype.get=function(t){return this.readUInt8(t)},t.prototype.write=function(e,n,r,i){if(void 0===n&&(n=0),void 0===r&&(r=this.length),void 0===i&&(i="utf8"),"string"==typeof n?(i=""+n,n=0,r=this.length):"string"==typeof r&&(i=""+r,r=this.length),n>this.length||n<0)throw new RangeError("Invalid offset.");var o=a.FindUtil(i);return r=r+n>this.length?this.length-n:r,n+=this.offset,o.str2byte(e,0===n&&r===this.length?this:new t(this.data,n,r+n))},t.prototype.toString=function(e,n,r){if(void 0===e&&(e="utf8"),void 0===n&&(n=0),void 0===r&&(r=this.length),!(n<=r))throw new Error("Invalid start/end positions: "+n+" - "+r);if(n===r)return"";r>this.length&&(r=this.length);var i=a.FindUtil(e);return i.byte2str(0===n&&r===this.length?this:new t(this.data,n+this.offset,r+this.offset))},t.prototype.toJSON=function(){for(var t=this.length,e=new Array(t),n=0;n<t;n++)e[n]=this.readUInt8(n);return{type:"Buffer",data:e}},t.prototype.inspect=function(){var t,e=[],n=this.length<50?this.length:50;for(t=0;t<n;t++)e.push(this.readUInt8(t).toString(16));return"<Buffer "+e.join(" ")+(this.length>50?" ... ":"")+">"},t.prototype.toArrayBuffer=function(){var e=this.getBufferCore();if(e instanceof o.BufferCoreArrayBuffer){var n=e.getDataView(),r=n.buffer;return 0===n.byteOffset&&n.byteLength===r.byteLength?r:r.slice(n.byteOffset,n.byteLength)}var r=new ArrayBuffer(this.length),i=new t(r);return this.copy(i,0,0,this.length),r},t.prototype.indexOf=function(e,n){void 0===n&&(n=0);var r;r="string"==typeof e?new t(e,"utf8"):t.isBuffer(e)?e:new t(e);for(var i=0,o=r.length,s=this.length;i<o&&n<s;)r.readUInt8(i)==this.readUInt8(n)?i++:i=0,n++;return i==o?n-o:-1},t.prototype.copy=function(t,e,n,r){if(void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=this.length),n<0)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");if(e<0)throw new RangeError("targetStart out of bounds");if(r<=n||n>=this.length||e>t.length)return 0;var i,o=Math.min(r-n,t.length-e,this.length-n);for(i=0;i<o-3;i+=4)t.writeInt32LE(this.readInt32LE(n+i),e+i);for(i=4294967292&o;i<o;i++)t.writeUInt8(this.readUInt8(n+i),e+i);return o},t.prototype.slice=function(e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.length),e<0&&(e+=this.length,e<0&&(e=0)),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length),e>n&&(e=n),e<0||n<0||e>=this.length||n>this.length)throw new Error("Invalid slice indices.");return new t(this.data,e+this.offset,n+this.offset)},t.prototype.sliceCopy=function(e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.length),e<0&&(e+=this.length,e<0&&(e=0)),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length),e>n&&(e=n),e<0||n<0||e>=this.length||n>this.length)throw new Error("Invalid slice indices.");return new t(this.data.copy(e+this.offset,n+this.offset))},t.prototype.fill=function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=this.length);if(n>>=0,r>>>=0,n<0||r>this.length)throw new RangeError("out of range index");if(!(r<=n)){if("string"!=typeof e)e>>>=0;else if(1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if("number"==typeof e)n+=this.offset,r+=this.offset,this.data.fill(e,n,r);else if(e.length>0){for(var o=t.byteLength(e,"utf8"),s=r-o;n<s;)this.write(e,n,o,"utf8"),n+=o;n<r&&this.write(e,n,r-n,"utf8")}}},t.prototype.readUIntLE=function(t,e,n){void 0===n&&(n=!1),t+=this.offset;var r=0;switch(e){case 1:return this.data.readUInt8(t);case 2:return this.data.readUInt16LE(t);case 3:return this.data.readUInt8(t)|this.data.readUInt16LE(t+1)<<8;case 4:return this.data.readUInt32LE(t);case 6:r+=131072*(this.data.readUInt8(t+5)<<23);case 5:return r+=512*(this.data.readUInt8(t+5)<<23),r+this.data.readUInt32LE(t);default:throw new Error("Invalid byteLength: "+e)}},t.prototype.readUIntBE=function(t,e,n){void 0===n&&(n=!1),t+=this.offset;var r=0;switch(e){case 1:return this.data.readUInt8(t);case 2:return this.data.readUInt16BE(t);case 3:return this.data.readUInt8(t+2)|this.data.readUInt16BE(t)<<8;case 4:return this.data.readUInt32BE(t);case 6:r+=131072*(this.data.readUInt8(t)<<23),t++;case 5:return r+=512*(this.data.readUInt8(t)<<23),r+this.data.readUInt32BE(t+1);default:throw new Error("Invalid byteLength: "+e)}},t.prototype.readIntLE=function(t,e,n){switch(void 0===n&&(n=!1),t+=this.offset,e){case 1:return this.data.readInt8(t);case 2:return this.data.readInt16LE(t);case 3:return this.data.readUInt8(t)|this.data.readInt16LE(t+1)<<8;case 4:return this.data.readInt32LE(t);case 6:return 131072*(this.data.readInt8(t+5)<<23)+this.readUIntLE(t-this.offset,5,n);case 5:return 512*(this.data.readInt8(t+5)<<23)+this.data.readUInt32LE(t);default:throw new Error("Invalid byteLength: "+e)}},t.prototype.readIntBE=function(t,e,n){switch(void 0===n&&(n=!1),t+=this.offset,e){case 1:return this.data.readInt8(t);case 2:return this.data.readInt16BE(t);case 3:return this.data.readUInt8(t+2)|this.data.readInt16BE(t)<<8;case 4:return this.data.readInt32BE(t);case 6:return 131072*(this.data.readInt8(t)<<23)+this.readUIntBE(t-this.offset+1,5,n);case 5:return 512*(this.data.readInt8(t)<<23)+this.data.readUInt32BE(t+1);default:throw new Error("Invalid byteLength: "+e)}},t.prototype.readUInt8=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readUInt8(t)},t.prototype.readUInt16LE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readUInt16LE(t)},t.prototype.readUInt16BE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readUInt16BE(t)},t.prototype.readUInt32LE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readUInt32LE(t)},t.prototype.readUInt32BE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readUInt32BE(t)},t.prototype.readInt8=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readInt8(t)},t.prototype.readInt16LE=function(t,e){
return void 0===e&&(e=!1),t+=this.offset,this.data.readInt16LE(t)},t.prototype.readInt16BE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readInt16BE(t)},t.prototype.readInt32LE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readInt32LE(t)},t.prototype.readInt32BE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readInt32BE(t)},t.prototype.readFloatLE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readFloatLE(t)},t.prototype.readFloatBE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readFloatBE(t)},t.prototype.readDoubleLE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readDoubleLE(t)},t.prototype.readDoubleBE=function(t,e){return void 0===e&&(e=!1),t+=this.offset,this.data.readDoubleBE(t)},t.prototype.writeUIntLE=function(t,e,n,r){void 0===r&&(r=!1);var i=e+n;switch(e+=this.offset,n){case 1:this.data.writeUInt8(t,e);break;case 2:this.data.writeUInt16LE(t,e);break;case 3:this.data.writeUInt8(255&t,e),this.data.writeUInt16LE(t>>8,e+1);break;case 4:this.data.writeUInt32LE(t,e);break;case 6:this.data.writeUInt8(255&t,e),t=Math.floor(t/256),e++;case 5:this.data.writeUInt8(255&t,e),t=Math.floor(t/256),this.data.writeUInt32LE(t,e+1);break;default:throw new Error("Invalid byteLength: "+n)}return i},t.prototype.writeUIntBE=function(t,e,n,r){void 0===r&&(r=!1);var i=e+n;switch(e+=this.offset,n){case 1:this.data.writeUInt8(t,e);break;case 2:this.data.writeUInt16BE(t,e);break;case 3:this.data.writeUInt8(255&t,e+2),this.data.writeUInt16BE(t>>8,e);break;case 4:this.data.writeUInt32BE(t,e);break;case 6:this.data.writeUInt8(255&t,e+5),t=Math.floor(t/256);case 5:this.data.writeUInt8(255&t,e+4),t=Math.floor(t/256),this.data.writeUInt32BE(t,e);break;default:throw new Error("Invalid byteLength: "+n)}return i},t.prototype.writeIntLE=function(t,e,n,r){void 0===r&&(r=!1);var i=e+n;switch(e+=this.offset,n){case 1:this.data.writeInt8(t,e);break;case 2:this.data.writeInt16LE(t,e);break;case 3:this.data.writeUInt8(255&t,e),this.data.writeInt16LE(t>>8,e+1);break;case 4:this.data.writeInt32LE(t,e);break;case 6:this.data.writeUInt8(255&t,e),t=Math.floor(t/256),e++;case 5:this.data.writeUInt8(255&t,e),t=Math.floor(t/256),this.data.writeInt32LE(t,e+1);break;default:throw new Error("Invalid byteLength: "+n)}return i},t.prototype.writeIntBE=function(t,e,n,r){void 0===r&&(r=!1);var i=e+n;switch(e+=this.offset,n){case 1:this.data.writeInt8(t,e);break;case 2:this.data.writeInt16BE(t,e);break;case 3:this.data.writeUInt8(255&t,e+2),this.data.writeInt16BE(t>>8,e);break;case 4:this.data.writeInt32BE(t,e);break;case 6:this.data.writeUInt8(255&t,e+5),t=Math.floor(t/256);case 5:this.data.writeUInt8(255&t,e+4),t=Math.floor(t/256),this.data.writeInt32BE(t,e);break;default:throw new Error("Invalid byteLength: "+n)}return i},t.prototype.writeUInt8=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeUInt8(e,t)},t.prototype.writeUInt16LE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeUInt16LE(e,t)},t.prototype.writeUInt16BE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeUInt16BE(e,t)},t.prototype.writeUInt32LE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeUInt32LE(e,t)},t.prototype.writeUInt32BE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeUInt32BE(e,t)},t.prototype.writeInt8=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeInt8(e,t)},t.prototype.writeInt16LE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeInt16LE(e,t)},t.prototype.writeInt16BE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeInt16BE(e,t)},t.prototype.writeInt32LE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeInt32LE(e,t)},t.prototype.writeInt32BE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeInt32BE(e,t)},t.prototype.writeFloatLE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeFloatLE(e,t)},t.prototype.writeFloatBE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeFloatBE(e,t)},t.prototype.writeDoubleLE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeDoubleLE(e,t)},t.prototype.writeDoubleBE=function(t,e,n){void 0===n&&(n=!1),e+=this.offset,this.data.writeDoubleBE(e,t)},t.isEncoding=function(t){try{a.FindUtil(t)}catch(e){return!1}return!0},t.compare=function(t,e){if(t===e)return 0;var n,r,i,o=t.length,s=e.length,a=Math.min(o,s);for(n=0;n<a;n++)if(r=t.readUInt8(n),i=e.readUInt8(n),r!==i)return r>i?1:-1;return o===s?0:o>s?1:-1},t.isBuffer=function(e){return e instanceof t},t.byteLength=function(t,e){void 0===e&&(e="utf8");var n=a.FindUtil(e);return"string"!=typeof t&&(t=""+t),n.byteLength(t)},t.concat=function(e,n){var r;if(0===e.length||0===n)return new t(0);if(null==n){n=0;for(var i=0;i<e.length;i++)r=e[i],n+=r.length}for(var o=new t(n),s=0,a=0;a<e.length;a++)r=e[a],s+=r.copy(o,s);return o},t.prototype.equals=function(t){var e;if(t.length!==this.length)return!1;for(e=0;e<this.length;e++)if(this.readUInt8(e)!==t.readUInt8(e))return!1},t.prototype.compare=function(e){return t.compare(this,e)},t}();n.Buffer=f},{"./buffer_core":16,"./buffer_core_array":17,"./buffer_core_arraybuffer":18,"./buffer_core_imagedata":19,"./string_util":28}],16:[function(t,e,n){var r=Math.pow(2,128),i=-1*r,o=2139095040,s=-8388608,a=2143289344,u=function(){function t(){}return t.prototype.getLength=function(){throw new Error("BufferCore implementations should implement getLength.")},t.prototype.writeInt8=function(t,e){this.writeUInt8(t,255&e|(2147483648&e)>>>24)},t.prototype.writeInt16LE=function(t,e){this.writeUInt8(t,255&e),this.writeUInt8(t+1,e>>>8&255|(2147483648&e)>>>24)},t.prototype.writeInt16BE=function(t,e){this.writeUInt8(t+1,255&e),this.writeUInt8(t,e>>>8&255|(2147483648&e)>>>24)},t.prototype.writeInt32LE=function(t,e){this.writeUInt8(t,255&e),this.writeUInt8(t+1,e>>>8&255),this.writeUInt8(t+2,e>>>16&255),this.writeUInt8(t+3,e>>>24&255)},t.prototype.writeInt32BE=function(t,e){this.writeUInt8(t+3,255&e),this.writeUInt8(t+2,e>>>8&255),this.writeUInt8(t+1,e>>>16&255),this.writeUInt8(t,e>>>24&255)},t.prototype.writeUInt8=function(t,e){throw new Error("BufferCore implementations should implement writeUInt8.")},t.prototype.writeUInt16LE=function(t,e){this.writeUInt8(t,255&e),this.writeUInt8(t+1,e>>8&255)},t.prototype.writeUInt16BE=function(t,e){this.writeUInt8(t+1,255&e),this.writeUInt8(t,e>>8&255)},t.prototype.writeUInt32LE=function(t,e){this.writeInt32LE(t,0|e)},t.prototype.writeUInt32BE=function(t,e){this.writeInt32BE(t,0|e)},t.prototype.writeFloatLE=function(t,e){this.writeInt32LE(t,this.float2intbits(e))},t.prototype.writeFloatBE=function(t,e){this.writeInt32BE(t,this.float2intbits(e))},t.prototype.writeDoubleLE=function(t,e){var n=this.double2longbits(e);this.writeInt32LE(t,n[0]),this.writeInt32LE(t+4,n[1])},t.prototype.writeDoubleBE=function(t,e){var n=this.double2longbits(e);this.writeInt32BE(t+4,n[0]),this.writeInt32BE(t,n[1])},t.prototype.readInt8=function(t){var e=this.readUInt8(t);return 128&e?4294967168|e:e},t.prototype.readInt16LE=function(t){var e=this.readUInt16LE(t);return 32768&e?4294934528|e:e},t.prototype.readInt16BE=function(t){var e=this.readUInt16BE(t);return 32768&e?4294934528|e:e},t.prototype.readInt32LE=function(t){return 0|this.readUInt32LE(t)},t.prototype.readInt32BE=function(t){return 0|this.readUInt32BE(t)},t.prototype.readUInt8=function(t){throw new Error("BufferCore implementations should implement readUInt8.")},t.prototype.readUInt16LE=function(t){return this.readUInt8(t+1)<<8|this.readUInt8(t)},t.prototype.readUInt16BE=function(t){return this.readUInt8(t)<<8|this.readUInt8(t+1)},t.prototype.readUInt32LE=function(t){return(this.readUInt8(t+3)<<24|this.readUInt8(t+2)<<16|this.readUInt8(t+1)<<8|this.readUInt8(t))>>>0},t.prototype.readUInt32BE=function(t){return(this.readUInt8(t)<<24|this.readUInt8(t+1)<<16|this.readUInt8(t+2)<<8|this.readUInt8(t+3))>>>0},t.prototype.readFloatLE=function(t){return this.intbits2float(this.readInt32LE(t))},t.prototype.readFloatBE=function(t){return this.intbits2float(this.readInt32BE(t))},t.prototype.readDoubleLE=function(t){return this.longbits2double(this.readInt32LE(t+4),this.readInt32LE(t))},t.prototype.readDoubleBE=function(t){return this.longbits2double(this.readInt32BE(t),this.readInt32BE(t+4))},t.prototype.copy=function(t,e){throw new Error("BufferCore implementations should implement copy.")},t.prototype.fill=function(t,e,n){for(var r=e;r<n;r++)this.writeUInt8(r,t)},t.prototype.float2intbits=function(t){var e,n,r;return 0===t?0:t===Number.POSITIVE_INFINITY?o:t===Number.NEGATIVE_INFINITY?s:isNaN(t)?a:(r=t<0?1:0,t=Math.abs(t),t<=1.1754942106924411e-38&&t>=1.401298464324817e-45?(e=0,n=Math.round(t/Math.pow(2,-126)*Math.pow(2,23)),r<<31|e<<23|n):(e=Math.floor(Math.log(t)/Math.LN2),n=Math.round((t/Math.pow(2,e)-1)*Math.pow(2,23)),r<<31|e+127<<23|n))},t.prototype.double2longbits=function(t){var e,n,r,i;return 0===t?[0,0]:t===Number.POSITIVE_INFINITY?[0,2146435072]:t===Number.NEGATIVE_INFINITY?[0,-1048576]:isNaN(t)?[0,2146959360]:(i=t<0?1<<31:0,t=Math.abs(t),t<=2.225073858507201e-308&&t>=5e-324?(e=0,r=t/Math.pow(2,-1022)*Math.pow(2,52)):(e=Math.floor(Math.log(t)/Math.LN2),t<Math.pow(2,e)&&(e-=1),r=(t/Math.pow(2,e)-1)*Math.pow(2,52),e=e+1023<<20),n=r*Math.pow(2,-32)|0|i|e,[65535&r,n])},t.prototype.intbits2float=function(t){if(t===o)return Number.POSITIVE_INFINITY;if(t===s)return Number.NEGATIVE_INFINITY;var e,n=(2147483648&t)>>>31,a=(2139095040&t)>>>23,u=8388607&t;return e=0===a?Math.pow(-1,n)*u*Math.pow(2,-149):Math.pow(-1,n)*(1+u*Math.pow(2,-23))*Math.pow(2,a-127),(e<i||e>r)&&(e=NaN),e},t.prototype.longbits2double=function(t,e){var n=(2147483648&t)>>>31,r=(2146435072&t)>>>20,i=(1048575&t)*Math.pow(2,32)+e;return 0===r&&0===i?0:2047===r?0===i?1===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:NaN:0===r?Math.pow(-1,n)*i*Math.pow(2,-1074):Math.pow(-1,n)*(1+i*Math.pow(2,-52))*Math.pow(2,r-1023)},t}();n.BufferCoreCommon=u},{}],17:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./buffer_core"),o=[4294967040,4294902015,4278255615,16777215],s=function(t){function e(e){t.call(this),this.length=e,this.buff=new Array(Math.ceil(e/4));for(var n=this.buff.length,r=0;r<n;r++)this.buff[r]=0}return r(e,t),e.isAvailable=function(){return!0},e.prototype.getLength=function(){return this.length},e.prototype.writeUInt8=function(t,e){e&=255;var n=t>>2,r=3&t;this.buff[n]=this.buff[n]&o[r],this.buff[n]=this.buff[n]|e<<(r<<3)},e.prototype.readUInt8=function(t){var e=t>>2,n=3&t;return this.buff[e]>>(n<<3)&255},e.prototype.copy=function(t,n){for(var r=new e(n-t),i=t;i<n;i++)r.writeUInt8(i-t,this.readUInt8(i));return r},e.name="Array",e}(i.BufferCoreCommon);n.BufferCoreArray=s},{"./buffer_core":16}],18:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./buffer_core"),o=function(t){function e(e){t.call(this),"number"==typeof e?this.buff=new DataView(new ArrayBuffer(e)):e instanceof DataView?this.buff=e:this.buff=new DataView(e),this.length=this.buff.byteLength}return r(e,t),e.isAvailable=function(){return"undefined"!=typeof DataView},e.prototype.getLength=function(){return this.length},e.prototype.writeInt8=function(t,e){this.buff.setInt8(t,e)},e.prototype.writeInt16LE=function(t,e){this.buff.setInt16(t,e,!0)},e.prototype.writeInt16BE=function(t,e){this.buff.setInt16(t,e,!1)},e.prototype.writeInt32LE=function(t,e){this.buff.setInt32(t,e,!0)},e.prototype.writeInt32BE=function(t,e){this.buff.setInt32(t,e,!1)},e.prototype.writeUInt8=function(t,e){this.buff.setUint8(t,e)},e.prototype.writeUInt16LE=function(t,e){this.buff.setUint16(t,e,!0)},e.prototype.writeUInt16BE=function(t,e){this.buff.setUint16(t,e,!1)},e.prototype.writeUInt32LE=function(t,e){this.buff.setUint32(t,e,!0)},e.prototype.writeUInt32BE=function(t,e){this.buff.setUint32(t,e,!1)},e.prototype.writeFloatLE=function(t,e){this.buff.setFloat32(t,e,!0)},e.prototype.writeFloatBE=function(t,e){this.buff.setFloat32(t,e,!1)},e.prototype.writeDoubleLE=function(t,e){this.buff.setFloat64(t,e,!0)},e.prototype.writeDoubleBE=function(t,e){this.buff.setFloat64(t,e,!1)},e.prototype.readInt8=function(t){return this.buff.getInt8(t)},e.prototype.readInt16LE=function(t){return this.buff.getInt16(t,!0)},e.prototype.readInt16BE=function(t){return this.buff.getInt16(t,!1)},e.prototype.readInt32LE=function(t){return this.buff.getInt32(t,!0)},e.prototype.readInt32BE=function(t){return this.buff.getInt32(t,!1)},e.prototype.readUInt8=function(t){return this.buff.getUint8(t)},e.prototype.readUInt16LE=function(t){return this.buff.getUint16(t,!0)},e.prototype.readUInt16BE=function(t){return this.buff.getUint16(t,!1)},e.prototype.readUInt32LE=function(t){return this.buff.getUint32(t,!0)},e.prototype.readUInt32BE=function(t){return this.buff.getUint32(t,!1)},e.prototype.readFloatLE=function(t){return this.buff.getFloat32(t,!0)},e.prototype.readFloatBE=function(t){return this.buff.getFloat32(t,!1)},e.prototype.readDoubleLE=function(t){return this.buff.getFloat64(t,!0)},e.prototype.readDoubleBE=function(t){return this.buff.getFloat64(t,!1)},e.prototype.copy=function(t,n){var r,i=this.buff.buffer;if(ArrayBuffer.prototype.slice)r=i.slice(t,n);else{var o=n-t;r=new ArrayBuffer(o);var s=new Uint8Array(r),a=new Uint8Array(i);s.set(a.subarray(t,n))}return new e(r)},e.prototype.fill=function(t,e,n){t=255&t;var r,i=n-e,o=4*(i/4|0),s=t<<24|t<<16|t<<8|t;for(r=0;r<o;r+=4)this.writeInt32LE(r+e,s);for(r=o;r<i;r++)this.writeUInt8(r+e,t)},e.prototype.getDataView=function(){return this.buff},e.name="ArrayBuffer",e}(i.BufferCoreCommon);n.BufferCoreArrayBuffer=o},{"./buffer_core":16}],19:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./buffer_core"),o=function(t){function e(n){t.call(this),this.length=n,this.buff=e.getCanvasPixelArray(n)}return r(e,t),e.getCanvasPixelArray=function(t){var n=e.imageDataFactory;return void 0===n&&(e.imageDataFactory=n=document.createElement("canvas").getContext("2d")),0===t&&(t=1),n.createImageData(Math.ceil(t/4),1).data},e.isAvailable=function(){return"undefined"!=typeof CanvasPixelArray},e.prototype.getLength=function(){return this.length},e.prototype.writeUInt8=function(t,e){this.buff[t]=e},e.prototype.readUInt8=function(t){return this.buff[t]},e.prototype.copy=function(t,n){for(var r=new e(n-t),i=t;i<n;i++)r.writeUInt8(i-t,this.buff[i]);return r},e.name="ImageData",e}(i.BufferCoreCommon);n.BufferCoreImageData=o},{"./buffer_core":16}],20:[function(t,e,n){var r=t("./api_error"),i=r.ApiError,o=r.ErrorCode,s=function(){function t(){}return t.prototype.sync=function(t){t(new i(o.ENOTSUP))},t.prototype.syncSync=function(){throw new i(o.ENOTSUP)},t.prototype.datasync=function(t){this.sync(t)},t.prototype.datasyncSync=function(){return this.syncSync()},t.prototype.chown=function(t,e,n){n(new i(o.ENOTSUP))},t.prototype.chownSync=function(t,e){throw new i(o.ENOTSUP)},t.prototype.chmod=function(t,e){e(new i(o.ENOTSUP))},t.prototype.chmodSync=function(t){throw new i(o.ENOTSUP)},t.prototype.utimes=function(t,e,n){n(new i(o.ENOTSUP))},t.prototype.utimesSync=function(t,e){throw new i(o.ENOTSUP)},t}();n.BaseFile=s},{"./api_error":13}],21:[function(t,e,n){var r=t("./api_error");!function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(n.ActionType||(n.ActionType={}));var i=n.ActionType,o=function(){function t(e){if(this.flagStr=e,t.validFlagStrs.indexOf(e)<0)throw new r.ApiError(r.ErrorCode.EINVAL,"Invalid flag: "+e)}return t.getFileFlag=function(e){return t.flagCache.hasOwnProperty(e)?t.flagCache[e]:t.flagCache[e]=new t(e)},t.prototype.getFlagString=function(){return this.flagStr},t.prototype.isReadable=function(){return this.flagStr.indexOf("r")!==-1||this.flagStr.indexOf("+")!==-1},t.prototype.isWriteable=function(){return this.flagStr.indexOf("w")!==-1||this.flagStr.indexOf("a")!==-1||this.flagStr.indexOf("+")!==-1},t.prototype.isTruncating=function(){return this.flagStr.indexOf("w")!==-1},t.prototype.isAppendable=function(){return this.flagStr.indexOf("a")!==-1},t.prototype.isSynchronous=function(){return this.flagStr.indexOf("s")!==-1},t.prototype.isExclusive=function(){return this.flagStr.indexOf("x")!==-1},t.prototype.pathExistsAction=function(){return this.isExclusive()?i.THROW_EXCEPTION:this.isTruncating()?i.TRUNCATE_FILE:i.NOP},t.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?i.CREATE_FILE:i.THROW_EXCEPTION},t.flagCache={},t.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],t}();n.FileFlag=o},{"./api_error":13}],22:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./api_error"),o=t("./file_flag"),s=t("./node_path"),a=t("./buffer"),u=i.ApiError,c=i.ErrorCode,f=a.Buffer,h=o.ActionType,l=function(){function t(){}return t.prototype.supportsLinks=function(){return!1},t.prototype.diskSpace=function(t,e){e(0,0)},t.prototype.openFile=function(t,e,n){throw new u(c.ENOTSUP)},t.prototype.createFile=function(t,e,n,r){throw new u(c.ENOTSUP)},t.prototype.open=function(t,e,n,r){var i=this,o=function(o,a){if(o)switch(e.pathNotExistsAction()){case h.CREATE_FILE:return i.stat(s.dirname(t),!1,function(o,a){o?r(o):a.isDirectory()?i.createFile(t,e,n,r):r(new u(c.ENOTDIR,s.dirname(t)+" is not a directory."))});case h.THROW_EXCEPTION:return r(new u(c.ENOENT,""+t+" doesn't exist."));default:return r(new u(c.EINVAL,"Invalid FileFlag object."))}else{if(a.isDirectory())return r(new u(c.EISDIR,t+" is a directory."));switch(e.pathExistsAction()){case h.THROW_EXCEPTION:return r(new u(c.EEXIST,t+" already exists."));case h.TRUNCATE_FILE:return i.openFile(t,e,function(t,e){t?r(t):e.truncate(0,function(){e.sync(function(){r(null,e)})})});case h.NOP:return i.openFile(t,e,r);default:return r(new u(c.EINVAL,"Invalid FileFlag object."))}}};this.stat(t,!1,o)},t.prototype.rename=function(t,e,n){n(new u(c.ENOTSUP))},t.prototype.renameSync=function(t,e){throw new u(c.ENOTSUP)},t.prototype.stat=function(t,e,n){n(new u(c.ENOTSUP))},t.prototype.statSync=function(t,e){throw new u(c.ENOTSUP)},t.prototype.openFileSync=function(t,e){throw new u(c.ENOTSUP)},t.prototype.createFileSync=function(t,e,n){throw new u(c.ENOTSUP)},t.prototype.openSync=function(t,e,n){var r;try{r=this.statSync(t,!1)}catch(i){switch(e.pathNotExistsAction()){case h.CREATE_FILE:var o=this.statSync(s.dirname(t),!1);if(!o.isDirectory())throw new u(c.ENOTDIR,s.dirname(t)+" is not a directory.");return this.createFileSync(t,e,n);case h.THROW_EXCEPTION:throw new u(c.ENOENT,""+t+" doesn't exist.");default:throw new u(c.EINVAL,"Invalid FileFlag object.")}}if(r.isDirectory())throw new u(c.EISDIR,t+" is a directory.");switch(e.pathExistsAction()){case h.THROW_EXCEPTION:throw new u(c.EEXIST,t+" already exists.");case h.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,r.mode);case h.NOP:return this.openFileSync(t,e);default:throw new u(c.EINVAL,"Invalid FileFlag object.")}},t.prototype.unlink=function(t,e){e(new u(c.ENOTSUP))},t.prototype.unlinkSync=function(t){throw new u(c.ENOTSUP)},t.prototype.rmdir=function(t,e){e(new u(c.ENOTSUP))},t.prototype.rmdirSync=function(t){throw new u(c.ENOTSUP)},t.prototype.mkdir=function(t,e,n){n(new u(c.ENOTSUP))},t.prototype.mkdirSync=function(t,e){throw new u(c.ENOTSUP)},t.prototype.readdir=function(t,e){e(new u(c.ENOTSUP))},t.prototype.readdirSync=function(t){throw new u(c.ENOTSUP)},t.prototype.exists=function(t,e){this.stat(t,null,function(t){e(null==t)})},t.prototype.existsSync=function(t){try{return this.statSync(t,!0),!0}catch(e){return!1}},t.prototype.realpath=function(t,e,n){if(this.supportsLinks())for(var r=t.split(s.sep),i=0;i<r.length;i++){var o=r.slice(0,i+1);r[i]=s.join.apply(null,o)}else this.exists(t,function(e){e?n(null,t):n(new u(c.ENOENT,"File "+t+" not found."))})},t.prototype.realpathSync=function(t,e){if(!this.supportsLinks()){if(this.existsSync(t))return t;throw new u(c.ENOENT,"File "+t+" not found.")}for(var n=t.split(s.sep),r=0;r<n.length;r++){var i=n.slice(0,r+1);n[r]=s.join.apply(null,i)}},t.prototype.truncate=function(t,e,n){this.open(t,o.FileFlag.getFileFlag("r+"),420,function(t,r){return t?n(t):void r.truncate(e,function(t){r.close(function(e){n(t||e)})})})},t.prototype.truncateSync=function(t,e){var n=this.openSync(t,o.FileFlag.getFileFlag("r+"),420);try{n.truncateSync(e)}catch(r){throw r}finally{n.closeSync()}},t.prototype.readFile=function(t,e,n,r){var i=r;this.open(t,n,420,function(t,n){return t?r(t):(r=function(t,e){n.close(function(n){return null==t&&(t=n),i(t,e)})},void n.stat(function(t,i){if(null!=t)return r(t);var o=new f(i.size);n.read(o,0,i.size,0,function(t){if(null!=t)return r(t);if(null===e)return r(t,o);try{r(null,o.toString(e))}catch(n){r(n)}})}))})},t.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.statSync(),o=new f(i.size);return r.readSync(o,0,i.size,0),r.closeSync(),null===e?o:o.toString(e)}finally{r.closeSync()}},t.prototype.writeFile=function(t,e,n,r,i,o){var s=o;this.open(t,r,420,function(t,r){if(null!=t)return o(t);o=function(t){r.close(function(e){s(null!=t?t:e)})};try{"string"==typeof e&&(e=new f(e,n))}catch(i){return o(i)}r.write(e,0,e.length,0,o)})},t.prototype.writeFileSync=function(t,e,n,r,i){var o=this.openSync(t,r,i);try{"string"==typeof e&&(e=new f(e,n)),o.writeSync(e,0,e.length,0)}finally{o.closeSync()}},t.prototype.appendFile=function(t,e,n,r,i,o){var s=o;this.open(t,r,i,function(t,r){return null!=t?o(t):(o=function(t){r.close(function(e){s(null!=t?t:e)})},"string"==typeof e&&(e=new f(e,n)),void r.write(e,0,e.length,null,o))})},t.prototype.appendFileSync=function(t,e,n,r,i){var o=this.openSync(t,r,i);try{"string"==typeof e&&(e=new f(e,n)),o.writeSync(e,0,e.length,null)}finally{o.closeSync()}},t.prototype.chmod=function(t,e,n,r){r(new u(c.ENOTSUP))},t.prototype.chmodSync=function(t,e,n){throw new u(c.ENOTSUP)},t.prototype.chown=function(t,e,n,r,i){i(new u(c.ENOTSUP))},t.prototype.chownSync=function(t,e,n,r){throw new u(c.ENOTSUP)},t.prototype.utimes=function(t,e,n,r){r(new u(c.ENOTSUP))},t.prototype.utimesSync=function(t,e,n){throw new u(c.ENOTSUP)},t.prototype.link=function(t,e,n){n(new u(c.ENOTSUP))},t.prototype.linkSync=function(t,e){throw new u(c.ENOTSUP)},t.prototype.symlink=function(t,e,n,r){r(new u(c.ENOTSUP))},t.prototype.symlinkSync=function(t,e,n){throw new u(c.ENOTSUP)},t.prototype.readlink=function(t,e){e(new u(c.ENOTSUP))},t.prototype.readlinkSync=function(t){throw new u(c.ENOTSUP)},t}();n.BaseFileSystem=l;var p=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.supportsSynch=function(){return!0},e.prototype.rename=function(t,e,n){try{this.renameSync(t,e),n()}catch(r){n(r)}},e.prototype.stat=function(t,e,n){try{n(null,this.statSync(t,e))}catch(r){n(r)}},e.prototype.open=function(t,e,n,r){try{r(null,this.openSync(t,e,n))}catch(i){r(i)}},e.prototype.unlink=function(t,e){try{this.unlinkSync(t),e()}catch(n){e(n)}},e.prototype.rmdir=function(t,e){try{this.rmdirSync(t),e()}catch(n){e(n)}},e.prototype.mkdir=function(t,e,n){try{this.mkdirSync(t,e),n()}catch(r){n(r)}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(n){e(n)}},e.prototype.chmod=function(t,e,n,r){try{this.chmodSync(t,e,n),r()}catch(i){r(i)}},e.prototype.chown=function(t,e,n,r,i){try{this.chownSync(t,e,n,r),i()}catch(o){i(o)}},e.prototype.utimes=function(t,e,n,r){try{this.utimesSync(t,e,n),r()}catch(i){r(i)}},e.prototype.link=function(t,e,n){try{this.linkSync(t,e),n()}catch(r){n(r)}},e.prototype.symlink=function(t,e,n,r){try{this.symlinkSync(t,e,n),r()}catch(i){r(i)}},e.prototype.readlink=function(t,e){try{e(null,this.readlinkSync(t))}catch(n){e(n)}},e}(l);n.SynchronousFileSystem=p},{"./api_error":13,"./buffer":15,"./file_flag":21,"./node_path":26}],23:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./buffer"),o=t("./api_error"),s=i.Buffer,a=o.ApiError,u=o.ErrorCode,c=function(){function t(t,e,n){this.data=t,this.encoding=e,this.cb=n,this.size="string"!=typeof t?t.length:s.byteLength(t,null!=e?e:void 0),"string"!=typeof this.data&&(this.data=this.data.sliceCopy())}return t.prototype.getData=function(t){return null==t?"string"==typeof this.data?new s(this.data,null!=this.encoding?this.encoding:void 0):this.data:"string"==typeof this.data?t===this.encoding?this.data:new s(this.data,null!=this.encoding?this.encoding:void 0).toString(t):this.data.toString(t)},t}(),f=function(){function t(){this._listeners={},this.maxListeners=10}return t.prototype.addListener=function(t,e){return"undefined"==typeof this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e)>this.maxListeners&&process.stdout.write("Warning: Event "+t+" has more than "+this.maxListeners+" listeners.\n"),this.emit("newListener",t,e),this},t.prototype.on=function(t,e){return this.addListener(t,e)},t.prototype.once=function(t,e){var n=!1,r=function(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))};return this.addListener(t,r)},t.prototype._emitRemoveListener=function(t,e){var n;if(this._listeners.removeListener&&this._listeners.removeListener.length>0)for(n=0;n<e.length;n++)this.emit("removeListener",t,e[n])},t.prototype.removeListener=function(t,e){var n=this._listeners[t];if("undefined"!=typeof n){var r=n.indexOf(e);r>-1&&n.splice(r,1)}return this.emit("removeListener",t,e),this},t.prototype.removeAllListeners=function(t){var e,n,r;if("undefined"!=typeof t)e=this._listeners[t],this._listeners[t]=[],this._emitRemoveListener(t,e);else for(n=Object.keys(this._listeners),r=0;r<n.length;r++)this.removeAllListeners(n[r]);return this},t.prototype.setMaxListeners=function(t){this.maxListeners=t},t.prototype.listeners=function(t){return"undefined"==typeof this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].slice(0)},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this._listeners[t],i=!1;if("undefined"!=typeof r){var o;for(o=0;o<r.length;o++)i=!0,r[o].apply(this,e)}return i},t}();n.AbstractEventEmitter=f;var h=function(t){function e(e,n){t.call(this),this.writable=e,this.readable=n,this.encoding=null,this.flowing=!1,this.buffer=[],this.endEvent=null,this.ended=!1,this.drained=!0}return r(e,t),e.prototype.addListener=function(e,n){var r=t.prototype.addListener.call(this,e,n),i=this;return"data"!==e||this.flowing?"readable"===e&&this.buffer.length>0&&setTimeout(function(){i.emit("readable")},0):this.resume(),r},e.prototype._processArgs=function(t,e,n){return"string"==typeof e?new c(t,e,n):new c(t,null,e)},e.prototype._processEvents=function(){var t=0===this.buffer.length;this.drained!==t&&this.drained&&this.emit("readable"),this.flowing&&0!==this.buffer.length&&this.emit("data",this.read()),this.drained=0===this.buffer.length},e.prototype.emitEvent=function(t,e){this.emit(t,e.getData(this.encoding)),e.cb&&e.cb()},e.prototype.write=function(t,e,n){if(this.ended)throw new a(u.EPERM,"Cannot write to an ended stream.");var r=this._processArgs(t,e,n);return this._push(r),this.flowing},e.prototype.end=function(t,e,n){if(this.ended)throw new a(u.EPERM,"Stream is already closed.");var r=this._processArgs(t,e,n);this.ended=!0,this.endEvent=r,this._processEvents()},e.prototype.read=function(t){var e,n,r,i,o=[],a=[],u=0,f=0,h="number"!=typeof t;for(h&&(t=4294967295),f=0;f<this.buffer.length&&u<t;f++)n=this.buffer[f],o.push(n.getData()),n.cb&&a.push(n.cb),u+=n.size,e=n.cb;if(!h&&u<t)return null;if(this.buffer=this.buffer.slice(o.length),i=u>t?t:u,r=s.concat(o),u>t&&(e&&a.pop(),this._push(new c(r.slice(t),null,e))),a.length>0&&setTimeout(function(){var t;for(t=0;t<a.length;t++)a[t]()},0),this.ended&&0===this.buffer.length&&null!==this.endEvent){var l=this.endEvent,p=this;this.endEvent=null,setTimeout(function(){p.emitEvent("end",l)},0)}return 0===o.length?(this.emit("_read"),null):null===this.encoding?r.slice(0,i):r.toString(this.encoding,0,i)},e.prototype.setEncoding=function(t){this.encoding=t},e.prototype.pause=function(){this.flowing=!1},e.prototype.resume=function(){this.flowing=!0,this._processEvents()},e.prototype.pipe=function(t,e){throw new a(u.EPERM,"Unimplemented.")},e.prototype.unpipe=function(t){},e.prototype.unshift=function(t){if(this.ended)throw new a(u.EPERM,"Stream has ended.");this.buffer.unshift(new c(t,this.encoding)),this._processEvents()},e.prototype._push=function(t){this.buffer.push(t),this._processEvents()},e.prototype.wrap=function(t){throw new a(u.EPERM,"Unimplemented.")},e}(f);n.AbstractDuplexStream=h},{"./api_error":13,"./buffer":15}],24:[function(t,e,n){function r(t,e){if("function"!=typeof t)throw new p(d.EINVAL,"Callback must be a function.");switch("undefined"==typeof __numWaiting&&(__numWaiting=0),__numWaiting++,e){case 1:return function(e){setImmediate(function(){return __numWaiting--,t(e)})};case 2:return function(e,n){setImmediate(function(){return __numWaiting--,t(e,n)})};case 3:return function(e,n,r){setImmediate(function(){return __numWaiting--,t(e,n,r)})};default:throw new Error("Invalid invocation of wrapCb.")}}function i(t){if("function"!=typeof t.write)throw new p(d.EBADF,"Invalid file descriptor.")}function o(t,e){switch(typeof t){case"number":return t;case"string":var n=parseInt(t,8);if(NaN!==n)return n;default:return e}}function s(t){if(t.indexOf("\0")>=0)throw new p(d.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new p(d.EINVAL,"Path must not be empty.");return l.resolve(t)}function a(t,e,n,r){switch(typeof t){case"object":return{encoding:"undefined"!=typeof t.encoding?t.encoding:e,flag:"undefined"!=typeof t.flag?t.flag:n,mode:o(t.mode,r)};case"string":return{encoding:t,flag:n,mode:r};default:return{encoding:e,flag:n,mode:r}}}function u(){}var c=t("./api_error"),f=t("./file_flag"),h=t("./buffer"),l=t("./node_path"),p=c.ApiError,d=c.ErrorCode,y=f.FileFlag,g=h.Buffer,w=function(){function t(){}return t._initialize=function(e){if(!e.constructor.isAvailable())throw new p(d.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return t.root=e},t._toUnixTimestamp=function(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)},t.getRootFS=function(){return t.root?t.root:null},t.rename=function(e,n,i){void 0===i&&(i=u);var o=r(i,1);try{t.root.rename(s(e),s(n),o)}catch(a){o(a)}},t.renameSync=function(e,n){t.root.renameSync(s(e),s(n))},t.exists=function(e,n){void 0===n&&(n=u);var i=r(n,1);try{return t.root.exists(s(e),i)}catch(o){return i(!1)}},t.existsSync=function(e){try{return t.root.existsSync(s(e))}catch(n){return!1}},t.stat=function(e,n){void 0===n&&(n=u);var i=r(n,2);try{return t.root.stat(s(e),!1,i)}catch(o){return i(o,null)}},t.statSync=function(e){return t.root.statSync(s(e),!1)},t.lstat=function(e,n){void 0===n&&(n=u);var i=r(n,2);try{return t.root.stat(s(e),!0,i)}catch(o){return i(o,null)}},t.lstatSync=function(e){return t.root.statSync(s(e),!0)},t.truncate=function(e,n,i){void 0===n&&(n=0),void 0===i&&(i=u);var o=0;"function"==typeof n?i=n:"number"==typeof n&&(o=n);var a=r(i,1);try{if(o<0)throw new p(d.EINVAL);return t.root.truncate(s(e),o,a)}catch(c){return a(c)}},t.truncateSync=function(e,n){if(void 0===n&&(n=0),n<0)throw new p(d.EINVAL);return t.root.truncateSync(s(e),n);
},t.unlink=function(e,n){void 0===n&&(n=u);var i=r(n,1);try{return t.root.unlink(s(e),i)}catch(o){return i(o)}},t.unlinkSync=function(e){return t.root.unlinkSync(s(e))},t.open=function(e,n,i,a){void 0===a&&(a=u);var c=o(i,420);a="function"==typeof i?i:a;var f=r(a,2);try{return t.root.open(s(e),y.getFileFlag(n),c,f)}catch(h){return f(h,null)}},t.openSync=function(e,n,r){return void 0===r&&(r=420),t.root.openSync(s(e),y.getFileFlag(n),r)},t.readFile=function(e,n,i){void 0===n&&(n={}),void 0===i&&(i=u);var o=a(n,null,"r",null);i="function"==typeof n?n:i;var c=r(i,2);try{var f=y.getFileFlag(o.flag);return f.isReadable()?t.root.readFile(s(e),o.encoding,f,c):c(new p(d.EINVAL,"Flag passed to readFile must allow for reading."))}catch(h){return c(h,null)}},t.readFileSync=function(e,n){void 0===n&&(n={});var r=a(n,null,"r",null),i=y.getFileFlag(r.flag);if(!i.isReadable())throw new p(d.EINVAL,"Flag passed to readFile must allow for reading.");return t.root.readFileSync(s(e),r.encoding,i)},t.writeFile=function(e,n,i,o){void 0===i&&(i={}),void 0===o&&(o=u);var c=a(i,"utf8","w",420);o="function"==typeof i?i:o;var f=r(o,1);try{var h=y.getFileFlag(c.flag);return h.isWriteable()?t.root.writeFile(s(e),n,c.encoding,h,c.mode,f):f(new p(d.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(l){return f(l)}},t.writeFileSync=function(e,n,r){var i=a(r,"utf8","w",420),o=y.getFileFlag(i.flag);if(!o.isWriteable())throw new p(d.EINVAL,"Flag passed to writeFile must allow for writing.");return t.root.writeFileSync(s(e),n,i.encoding,o,i.mode)},t.appendFile=function(e,n,i,o){void 0===o&&(o=u);var c=a(i,"utf8","a",420);o="function"==typeof i?i:o;var f=r(o,1);try{var h=y.getFileFlag(c.flag);if(!h.isAppendable())return f(new p(d.EINVAL,"Flag passed to appendFile must allow for appending."));t.root.appendFile(s(e),n,c.encoding,h,c.mode,f)}catch(l){f(l)}},t.appendFileSync=function(e,n,r){var i=a(r,"utf8","a",420),o=y.getFileFlag(i.flag);if(!o.isAppendable())throw new p(d.EINVAL,"Flag passed to appendFile must allow for appending.");return t.root.appendFileSync(s(e),n,i.encoding,o,i.mode)},t.fstat=function(t,e){void 0===e&&(e=u);var n=r(e,2);try{i(t),t.stat(n)}catch(o){n(o)}},t.fstatSync=function(t){return i(t),t.statSync()},t.close=function(t,e){void 0===e&&(e=u);var n=r(e,1);try{i(t),t.close(n)}catch(o){n(o)}},t.closeSync=function(t){return i(t),t.closeSync()},t.ftruncate=function(t,e,n){void 0===n&&(n=u);var o="number"==typeof e?e:0;n="function"==typeof e?e:n;var s=r(n,1);try{if(i(t),o<0)throw new p(d.EINVAL);t.truncate(o,s)}catch(a){s(a)}},t.ftruncateSync=function(t,e){return void 0===e&&(e=0),i(t),t.truncateSync(e)},t.fsync=function(t,e){void 0===e&&(e=u);var n=r(e,1);try{i(t),t.sync(n)}catch(o){n(o)}},t.fsyncSync=function(t){return i(t),t.syncSync()},t.fdatasync=function(t,e){void 0===e&&(e=u);var n=r(e,1);try{i(t),t.datasync(n)}catch(o){n(o)}},t.fdatasyncSync=function(t){i(t),t.datasyncSync()},t.write=function(t,e,n,o,s,a){void 0===a&&(a=u);var c,f,h,l=null;if("string"==typeof e){var y="utf8";switch(typeof n){case"function":a=n;break;case"number":l=n,y="string"==typeof o?o:"utf8",a="function"==typeof s?s:a;break;default:return(a="function"==typeof o?o:"function"==typeof s?s:a)(new p(d.EINVAL,"Invalid arguments."))}c=new g(e,y),f=0,h=c.length}else c=e,f=n,h=o,l="number"==typeof s?s:null,a="function"==typeof s?s:a;var w=r(a,3);try{i(t),null==l&&(l=t.getPos()),t.write(c,f,h,l,w)}catch(v){w(v)}},t.writeSync=function(t,e,n,r,o){var s,a,u,c=0;if("string"==typeof e){u="number"==typeof n?n:null;var f="string"==typeof r?r:"utf8";c=0,s=new g(e,f),a=s.length}else s=e,c=n,a=r,u="number"==typeof o?o:null;return i(t),null==u&&(u=t.getPos()),t.writeSync(s,c,a,u)},t.read=function(t,e,n,o,s,a){void 0===a&&(a=u);var c,f,h,l,p;if("number"==typeof e){h=e,c=n;var d=o;a="function"==typeof s?s:a,f=0,l=new g(h),p=r(function(t,e,n){return t?a(t):void a(t,n.toString(d),e)},3)}else l=e,f=n,h=o,c=s,p=r(a,3);try{i(t),null==c&&(c=t.getPos()),t.read(l,f,h,c,p)}catch(y){p(y)}},t.readSync=function(t,e,n,r,o){var s,a,u,c,f=!1;if("number"==typeof e){u=e,c=n;var h=r;a=0,s=new g(u),f=!0}else s=e,a=n,u=r,c=o;i(t),null==c&&(c=t.getPos());var l=t.readSync(s,a,u,c);return f?[s.toString(h),l]:l},t.fchown=function(t,e,n,o){void 0===o&&(o=u);var s=r(o,1);try{i(t),t.chown(e,n,s)}catch(a){s(a)}},t.fchownSync=function(t,e,n){return i(t),t.chownSync(e,n)},t.fchmod=function(t,e,n){void 0===n&&(n=u);var o=r(n,1);try{e="string"==typeof e?parseInt(e,8):e,i(t),t.chmod(e,o)}catch(s){o(s)}},t.fchmodSync=function(t,e){return e="string"==typeof e?parseInt(e,8):e,i(t),t.chmodSync(e)},t.futimes=function(t,e,n,o){void 0===o&&(o=u);var s=r(o,1);try{i(t),"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof n&&(n=new Date(1e3*n)),t.utimes(e,n,s)}catch(a){s(a)}},t.futimesSync=function(t,e,n){return i(t),"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof n&&(n=new Date(1e3*n)),t.utimesSync(e,n)},t.rmdir=function(e,n){void 0===n&&(n=u);var i=r(n,1);try{e=s(e),t.root.rmdir(e,i)}catch(o){i(o)}},t.rmdirSync=function(e){return e=s(e),t.root.rmdirSync(e)},t.mkdir=function(e,n,i){void 0===i&&(i=u),"function"==typeof n&&(i=n,n=511);var o=r(i,1);try{e=s(e),t.root.mkdir(e,n,o)}catch(a){o(a)}},t.mkdirSync=function(e,n){return void 0===n&&(n=511),n="string"==typeof n?parseInt(n,8):n,e=s(e),t.root.mkdirSync(e,n)},t.readdir=function(e,n){void 0===n&&(n=u);var i=r(n,2);try{e=s(e),t.root.readdir(e,i)}catch(o){i(o)}},t.readdirSync=function(e){return e=s(e),t.root.readdirSync(e)},t.link=function(e,n,i){void 0===i&&(i=u);var o=r(i,1);try{e=s(e),n=s(n),t.root.link(e,n,o)}catch(a){o(a)}},t.linkSync=function(e,n){return e=s(e),n=s(n),t.root.linkSync(e,n)},t.symlink=function(e,n,i,o){void 0===o&&(o=u);var a="string"==typeof i?i:"file";o="function"==typeof i?i:o;var c=r(o,1);try{if("file"!==a&&"dir"!==a)return c(new p(d.EINVAL,"Invalid type: "+a));e=s(e),n=s(n),t.root.symlink(e,n,a,c)}catch(f){c(f)}},t.symlinkSync=function(e,n,r){if(null==r)r="file";else if("file"!==r&&"dir"!==r)throw new p(d.EINVAL,"Invalid type: "+r);return e=s(e),n=s(n),t.root.symlinkSync(e,n,r)},t.readlink=function(e,n){void 0===n&&(n=u);var i=r(n,2);try{e=s(e),t.root.readlink(e,i)}catch(o){i(o)}},t.readlinkSync=function(e){return e=s(e),t.root.readlinkSync(e)},t.chown=function(e,n,i,o){void 0===o&&(o=u);var a=r(o,1);try{e=s(e),t.root.chown(e,!1,n,i,a)}catch(c){a(c)}},t.chownSync=function(e,n,r){e=s(e),t.root.chownSync(e,!1,n,r)},t.lchown=function(e,n,i,o){void 0===o&&(o=u);var a=r(o,1);try{e=s(e),t.root.chown(e,!0,n,i,a)}catch(c){a(c)}},t.lchownSync=function(e,n,r){return e=s(e),t.root.chownSync(e,!0,n,r)},t.chmod=function(e,n,i){void 0===i&&(i=u);var o=r(i,1);try{n="string"==typeof n?parseInt(n,8):n,e=s(e),t.root.chmod(e,!1,n,o)}catch(a){o(a)}},t.chmodSync=function(e,n){return n="string"==typeof n?parseInt(n,8):n,e=s(e),t.root.chmodSync(e,!1,n)},t.lchmod=function(e,n,i){void 0===i&&(i=u);var o=r(i,1);try{n="string"==typeof n?parseInt(n,8):n,e=s(e),t.root.chmod(e,!0,n,o)}catch(a){o(a)}},t.lchmodSync=function(e,n){return e=s(e),n="string"==typeof n?parseInt(n,8):n,t.root.chmodSync(e,!0,n)},t.utimes=function(e,n,i,o){void 0===o&&(o=u);var a=r(o,1);try{e=s(e),"number"==typeof n&&(n=new Date(1e3*n)),"number"==typeof i&&(i=new Date(1e3*i)),t.root.utimes(e,n,i,a)}catch(c){a(c)}},t.utimesSync=function(e,n,r){return e=s(e),"number"==typeof n&&(n=new Date(1e3*n)),"number"==typeof r&&(r=new Date(1e3*r)),t.root.utimesSync(e,n,r)},t.realpath=function(e,n,i){void 0===i&&(i=u);var o="object"==typeof n?n:{};i="function"==typeof n?n:u;var a=r(i,2);try{e=s(e),t.root.realpath(e,o,a)}catch(c){a(c)}},t.realpathSync=function(e,n){return void 0===n&&(n={}),e=s(e),t.root.realpathSync(e,n)},t.root=null,t}();n.fs=w},{"./api_error":13,"./buffer":15,"./file_flag":21,"./node_path":26}],25:[function(t,e,n){var r=t("./buffer"),i=r.Buffer;!function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(n.FileType||(n.FileType={}));var o=n.FileType,s=function(){function t(t,e,n,r,i,s){if(void 0===r&&(r=new Date),void 0===i&&(i=new Date),void 0===s&&(s=new Date),this.size=e,this.mode=n,this.atime=r,this.mtime=i,this.ctime=s,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.file_data=null,null==this.mode)switch(t){case o.FILE:this.mode=420;break;case o.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)}return t.prototype.toBuffer=function(){var t=new i(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t},t.fromBuffer=function(e){var n=e.readUInt32LE(0),r=e.readUInt32LE(4),i=e.readDoubleLE(8),o=e.readDoubleLE(16),s=e.readDoubleLE(24);return new t(61440&r,n,4095&r,new Date(i),new Date(o),new Date(s))},t.prototype.clone=function(){return new t(61440&this.mode,this.size,4095&this.mode,this.atime,this.mtime,this.ctime)},t.prototype.isFile=function(){return(61440&this.mode)===o.FILE},t.prototype.isDirectory=function(){return(61440&this.mode)===o.DIRECTORY},t.prototype.isSymbolicLink=function(){return(61440&this.mode)===o.SYMLINK},t.prototype.chmod=function(t){this.mode=61440&this.mode|t},t.prototype.isSocket=function(){return!1},t.prototype.isBlockDevice=function(){return!1},t.prototype.isCharacterDevice=function(){return!1},t.prototype.isFIFO=function(){return!1},t}();n.Stats=s},{"./buffer":15}],26:[function(t,e,n){var r=t("./node_process"),i=r.process,o=function(){function t(){}return t.normalize=function(e){""===e&&(e=".");var n=e.charAt(0)===t.sep;e=t._removeDuplicateSeps(e);for(var r=e.split(t.sep),i=[],o=0;o<r.length;o++){var s=r[o];"."!==s&&(".."===s&&(n||!n&&i.length>0&&".."!==i[0])?i.pop():i.push(s))}if(!n&&i.length<2)switch(i.length){case 1:""===i[0]&&i.unshift(".");break;default:i.push(".")}return e=i.join(t.sep),n&&e.charAt(0)!==t.sep&&(e=t.sep+e),e},t.join=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];for(var r=[],i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o)throw new TypeError("Invalid argument type to path.join: "+typeof o);""!==o&&r.push(o)}return t.normalize(r.join(t.sep))},t.resolve=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];for(var r=[],o=0;o<e.length;o++){var s=e[o];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&(s.charAt(0)===t.sep&&(r=[]),r.push(s))}var a=t.normalize(r.join(t.sep));if(a.length>1&&a.charAt(a.length-1)===t.sep)return a.substr(0,a.length-1);if(a.charAt(0)!==t.sep){"."!==a.charAt(0)||1!==a.length&&a.charAt(1)!==t.sep||(a=1===a.length?"":a.substr(2));var u=i.cwd();a=""!==a?this.normalize(u+("/"!==u?t.sep:"")+a):u}return a},t.relative=function(e,n){var r;e=t.resolve(e),n=t.resolve(n);var i=e.split(t.sep),o=n.split(t.sep);o.shift(),i.shift();var s=0,a=[];for(r=0;r<i.length;r++){var u=i[r];if(u!==o[r]){s=i.length-r;break}}a=o.slice(r),1===i.length&&""===i[0]&&(s=0),s>i.length&&(s=i.length);var c="";for(r=0;r<s;r++)c+="../";return c+=a.join(t.sep),c.length>1&&c.charAt(c.length-1)===t.sep&&(c=c.substr(0,c.length-1)),c},t.dirname=function(e){e=t._removeDuplicateSeps(e);var n=e.charAt(0)===t.sep,r=e.split(t.sep);return""===r.pop()&&r.length>0&&r.pop(),r.length>1||1===r.length&&!n?r.join(t.sep):n?t.sep:"."},t.basename=function(e,n){if(void 0===n&&(n=""),""===e)return e;e=t.normalize(e);var r=e.split(t.sep),i=r[r.length-1];if(""===i&&r.length>1)return r[r.length-2];if(n.length>0){var o=i.substr(i.length-n.length);if(o===n)return i.substr(0,i.length-n.length)}return i},t.extname=function(e){e=t.normalize(e);var n=e.split(t.sep);if(e=n.pop(),""===e&&n.length>0&&(e=n.pop()),".."===e)return"";var r=e.lastIndexOf(".");return r===-1||0===r?"":e.substr(r)},t.isAbsolute=function(e){return e.length>0&&e.charAt(0)===t.sep},t._makeLong=function(t){return t},t._removeDuplicateSeps=function(t){return t=t.replace(this._replaceRegex,this.sep)},t.sep="/",t._replaceRegex=new RegExp("//+","g"),t.delimiter=":",t}();e.exports=o},{"./node_process":27}],27:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("./node_eventemitter"),o=null,s=function(t){function e(){t.call(this,!0,!0),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0}return r(e,t),e.prototype.setReadMode=function(t){this.isRaw!==t&&(this.isRaw=t,this.emit("modeChange"))},e.prototype.changeColumns=function(t){t!==this.columns&&(this.columns=t,this.emit("resize"))},e.prototype.changeRows=function(t){t!==this.rows&&(this.rows=t,this.emit("resize"))},e.isatty=function(t){return t instanceof e},e}(i.AbstractDuplexStream);n.TTY=s;var a=function(){function e(){this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.stdout=new s,this.stderr=new s,this.stdin=new s}return e.prototype.chdir=function(e){null===o&&(o=t("./node_path")),this._cwd=o.resolve(e)},e.prototype.cwd=function(){return this._cwd},e.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},e}();n.Process=a,n.process=new a},{"./node_eventemitter":23,"./node_path":26}],28:[function(t,e,n){function r(t){switch(t=function(){switch(typeof t){case"object":return""+t;case"string":return t;default:throw new Error("Invalid encoding argument specified")}}(),t=t.toLowerCase()){case"utf8":case"utf-8":return i;case"ascii":return o;case"binary":return a;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c;case"hex":return f;case"base64":return u;case"binary_string":return h;case"binary_string_ie":return l;case"extended_ascii":return s;default:throw new Error("Unknown encoding: "+t)}}n.FindUtil=r;var i=function(){function t(){}return t.str2byte=function(t,e){for(var n=e.length,r=0,i=0,o=n,s=0;r<t.length&&i<o;){var a=t.charCodeAt(r++),u=t.charCodeAt(r);if(55296<=a&&a<=56319&&56320<=u&&u<=57343){if(i+3>=o)break;s++;var c=(1023&a|1024)<<10|1023&u;e.writeUInt8(c>>18|240,i++),e.writeUInt8(c>>12&63|128,i++),e.writeUInt8(c>>6&63|128,i++),e.writeUInt8(63&c|128,i++),r++}else if(a<128)e.writeUInt8(a,i++),s++;else if(a<2048){if(i+1>=o)break;s++,e.writeUInt8(a>>6|192,i++),e.writeUInt8(63&a|128,i++)}else if(a<65536){if(i+2>=o)break;s++,e.writeUInt8(a>>12|224,i++),e.writeUInt8(a>>6&63|128,i++),e.writeUInt8(63&a|128,i++)}}return i},t.byte2str=function(t){for(var e=[],n=0;n<t.length;){var r=t.readUInt8(n++);if(r<128)e.push(String.fromCharCode(r));else{if(r<192)throw new Error("Found incomplete part of character in string.");if(r<224)e.push(String.fromCharCode((31&r)<<6|63&t.readUInt8(n++)));else if(r<240)e.push(String.fromCharCode((15&r)<<12|(63&t.readUInt8(n++))<<6|63&t.readUInt8(n++)));else{if(!(r<248))throw new Error("Unable to represent UTF-8 string as UTF-16 JavaScript string.");var i=t.readUInt8(n+2);e.push(String.fromCharCode(1023&((7&r)<<8|(63&t.readUInt8(n++))<<2|(63&t.readUInt8(n++))>>4)|55296)),e.push(String.fromCharCode((15&i)<<6|63&t.readUInt8(n++)|56320))}}}return e.join("")},t.byteLength=function(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(e?e.length:0)},t}();n.UTF8=i;var o=function(){function t(){}return t.str2byte=function(t,e){for(var n=t.length>e.length?e.length:t.length,r=0;r<n;r++)e.writeUInt8(t.charCodeAt(r)%256,r);return n},t.byte2str=function(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=String.fromCharCode(127&t.readUInt8(n));return e.join("")},t.byteLength=function(t){return t.length},t}();n.ASCII=o;var s=function(){function t(){}return t.str2byte=function(e,n){for(var r=e.length>n.length?n.length:e.length,i=0;i<r;i++){var o=e.charCodeAt(i);if(o>127){var s=t.extendedChars.indexOf(e.charAt(i));s>-1&&(o=s+128)}n.writeUInt8(o,i)}return r},t.byte2str=function(e){for(var n=new Array(e.length),r=0;r<e.length;r++){var i=e.readUInt8(r);i>127?n[r]=t.extendedChars[i-128]:n[r]=String.fromCharCode(i)}return n.join("")},t.byteLength=function(t){return t.length},t.extendedChars=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "],t}();n.ExtendedASCII=s;var a=function(){function t(){}return t.str2byte=function(t,e){for(var n=t.length>e.length?e.length:t.length,r=0;r<n;r++)e.writeUInt8(255&t.charCodeAt(r),r);return n},t.byte2str=function(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=String.fromCharCode(255&t.readUInt8(n));return e.join("")},t.byteLength=function(t){return t.length},t}();n.BINARY=a;var u=function(){function t(){}return t.byte2str=function(e){for(var n="",r=0;r<e.length;){var i=e.readUInt8(r++),o=r<e.length?e.readUInt8(r++):NaN,s=r<e.length?e.readUInt8(r++):NaN,a=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|s>>6,f=63&s;isNaN(o)?c=f=64:isNaN(s)&&(f=64),n=n+t.num2b64[a]+t.num2b64[u]+t.num2b64[c]+t.num2b64[f]}return n},t.str2byte=function(e,n){var r=n.length,i="",o=0;e=e.replace(/[^A-Za-z0-9\+\/\=\-\_]/g,"");for(var s=0;o<e.length;){var a=t.b642num[e.charAt(o++)],u=t.b642num[e.charAt(o++)],c=t.b642num[e.charAt(o++)],f=t.b642num[e.charAt(o++)],h=a<<2|u>>4,l=(15&u)<<4|c>>2,p=(3&c)<<6|f;if(n.writeUInt8(h,s++),s===r)break;if(64!==c&&(i+=n.writeUInt8(l,s++)),s===r)break;if(64!==f&&(i+=n.writeUInt8(p,s++)),s===r)break}return s},t.byteLength=function(t){return Math.floor(6*t.replace(/[^A-Za-z0-9\+\/\-\_]/g,"").length/8)},t.b64chars=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/","="],t.num2b64=function(){for(var e=new Array(t.b64chars.length),n=0;n<t.b64chars.length;n++){var r=t.b64chars[n];e[n]=r}return e}(),t.b642num=function(){for(var e={},n=0;n<t.b64chars.length;n++){var r=t.b64chars[n];e[r]=n}return e["-"]=62,e._=63,e}(),t}();n.BASE64=u;var c=function(){function t(){}return t.str2byte=function(t,e){var n=t.length;2*n>e.length&&(n=e.length%2===1?(e.length-1)/2:e.length/2);for(var r=0;r<n;r++)e.writeUInt16LE(t.charCodeAt(r),2*r);return 2*n},t.byte2str=function(t){if(t.length%2!==0)throw new Error("Invalid UCS2 byte array.");for(var e=new Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=String.fromCharCode(t.readUInt8(n)|t.readUInt8(n+1)<<8);return e.join("")},t.byteLength=function(t){return 2*t.length},t}();n.UCS2=c;var f=function(){function t(){}return t.str2byte=function(t,e){if(t.length%2===1)throw new Error("Invalid hex string");var n=t.length>>1;n>e.length&&(n=e.length);for(var r=0;r<n;r++){var i=this.hex2num[t.charAt(r<<1)],o=this.hex2num[t.charAt((r<<1)+1)];e.writeUInt8(i<<4|o,r)}return n},t.byte2str=function(t){for(var e=t.length,n=new Array(e<<1),r=0,i=0;i<e;i++){var o=15&t.readUInt8(i),s=t.readUInt8(i)>>4;n[r++]=this.num2hex[s],n[r++]=this.num2hex[o]}return n.join("")},t.byteLength=function(t){return t.length>>1},t.HEXCHARS="0123456789abcdef",t.num2hex=function(){for(var e=new Array(t.HEXCHARS.length),n=0;n<t.HEXCHARS.length;n++){var r=t.HEXCHARS[n];e[n]=r}return e}(),t.hex2num=function(){var e,n,r={};for(e=0;e<t.HEXCHARS.length;e++)n=t.HEXCHARS[e],r[n]=e;var i="ABCDEF";for(e=0;e<i.length;e++)n=i[e],r[n]=e+10;return r}(),t}();n.HEX=f;var h=function(){function t(){}return t.str2byte=function(e,n){if(0===e.length)return 0;var r=t.byteLength(e);r>n.length&&(r=n.length);var i=0,o=0,s=o+r,a=e.charCodeAt(i++);0!==a&&(n.writeUInt8(255&a,0),o=1);for(var u=o;u<s;u+=2){var c=e.charCodeAt(i++);s-u===1&&n.writeUInt8(c>>8,u),s-u>=2&&n.writeUInt16BE(c,u)}return r},t.byte2str=function(t){var e=t.length;if(0===e)return"";for(var n=new Array((e>>1)+1),r=0,i=0;i<n.length;i++)0===i?e%2===1?n[i]=String.fromCharCode(256|t.readUInt8(r++)):n[i]=String.fromCharCode(0):n[i]=String.fromCharCode(t.readUInt8(r++)<<8|t.readUInt8(r++));return n.join("")},t.byteLength=function(t){if(0===t.length)return 0;var e=t.charCodeAt(0),n=t.length-1<<1;return 0!==e&&n++,n},t}();n.BINSTR=h;var l=function(){function t(){}return t.str2byte=function(t,e){for(var n=t.length>e.length?e.length:t.length,r=0;r<n;r++)e.writeUInt8(t.charCodeAt(r)-32,r);return n},t.byte2str=function(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=String.fromCharCode(t.readUInt8(n)+32);return e.join("")},t.byteLength=function(t){return t.length},t}();n.BINSTRIE=l},{}],29:[function(t,e,n){n.isIE="undefined"!=typeof navigator&&(null!=/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||navigator.userAgent.indexOf("Trident")!==-1),n.isWebWorker="undefined"==typeof window},{}],30:[function(t,e,n){var r=t("../core/node_fs_stats"),i=t("../core/node_path"),o=r.Stats,s=function(){function t(){this._index={},this.addPath("/",new u)}return t.prototype._split_path=function(t){var e=i.dirname(t),n=t.substr(e.length+("/"===e?0:1));return[e,n]},t.prototype.fileIterator=function(t){for(var e in this._index)for(var n=this._index[e],r=n.getListing(),i=0;i<r.length;i++){var o=n.getItem(r[i]);o.isFile()&&t(o.getData())}},t.prototype.addPath=function(t,e){if(null==e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;var n=this._split_path(t),r=n[0],i=n[1],o=this._index[r];return!(void 0===o&&"/"!==t&&(o=new u,!this.addPath(r,o)))&&(!("/"!==t&&!o.addItem(i,e))&&(e.isFile()||(this._index[t]=e),!0))},t.prototype.removePath=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];if(void 0===i)return null;var o=i.remItem(r);if(null===o)return null;if(!o.isFile()){for(var s=o,a=s.getListing(),u=0;u<a.length;u++)this.removePath(t+"/"+a[u]);"/"!==t&&delete this._index[t]}return o},t.prototype.ls=function(t){var e=this._index[t];return void 0===e?null:e.getListing()},t.prototype.getInode=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];return void 0===i?null:n===t?i:i.getItem(r)},t.from_listing=function(e){var n=new t,i=new u;n._index["/"]=i;for(var s=[["",e,i]];s.length>0;){var c,f=s.pop(),h=f[0],l=f[1],p=f[2];for(var d in l){var y=l[d],g=""+h+"/"+d;null!=y?(n._index[g]=c=new u,s.push([g,y,c])):c=new a(new o(r.FileType.FILE,(-1),365)),null!=p&&(p._ls[d]=c)}}return n},t}();n.FileIndex=s;var a=function(){function t(t){this.data=t}return t.prototype.isFile=function(){return!0},t.prototype.isDir=function(){return!1},t.prototype.getData=function(){return this.data},t.prototype.setData=function(t){this.data=t},t}();n.FileInode=a;var u=function(){function t(){this._ls={}}return t.prototype.isFile=function(){return!1},t.prototype.isDir=function(){return!0},t.prototype.getStats=function(){return new o(r.FileType.DIRECTORY,4096,365)},t.prototype.getListing=function(){return Object.keys(this._ls)},t.prototype.getItem=function(t){var e;return null!=(e=this._ls[t])?e:null},t.prototype.addItem=function(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)},t.prototype.remItem=function(t){var e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)},t}();n.DirInode=u},{"../core/node_fs_stats":25,"../core/node_path":26}],31:[function(t,e,n){var r=t("../core/node_fs_stats"),i=t("../core/buffer"),o=function(){function t(t,e,n,r,i,o){this.id=t,this.size=e,this.mode=n,this.atime=r,this.mtime=i,this.ctime=o}return t.prototype.toStats=function(){return new r.Stats((61440&this.mode)===r.FileType.DIRECTORY?r.FileType.DIRECTORY:r.FileType.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},t.prototype.getSize=function(){return 30+this.id.length},t.prototype.toBuffer=function(t){return void 0===t&&(t=new i.Buffer(this.getSize())),t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t},t.prototype.update=function(t){var e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);var n=t.atime.getTime();this.atime!==n&&(this.atime=n,e=!0);var r=t.mtime.getTime();this.mtime!==r&&(this.mtime=r,e=!0);var i=t.ctime.getTime();return this.ctime!==i&&(this.ctime=i,e=!0),e},t.fromBuffer=function(e){if(void 0===e)throw new Error("NO");return new t(e.toString("ascii",30),e.readUInt32LE(0),e.readUInt16LE(4),e.readDoubleLE(6),e.readDoubleLE(14),e.readDoubleLE(22))},t.prototype.isFile=function(){return(61440&this.mode)===r.FileType.FILE},t.prototype.isDirectory=function(){return(61440&this.mode)===r.FileType.DIRECTORY},t}();e.exports=o},{"../core/buffer":15,"../core/node_fs_stats":25}],32:[function(t,e,n){function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}function i(t,e){return!t||(e(t),!1)}function o(t,e,n){return!t||(e.abort(function(){n(t)}),!1)}var s=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=t("../core/file_system"),u=t("../core/api_error"),c=t("../core/node_fs_stats"),f=t("../core/node_path"),h=t("../generic/inode"),l=t("../core/buffer"),p=t("../generic/preload_file"),d="/",y=u.ApiError,g=l.Buffer,w=function(){function t(t){this.store=t,this.originalData={},this.modifiedKeys=[]}return t.prototype.stashOldValue=function(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)},t.prototype.markModified=function(t){this.modifiedKeys.indexOf(t)===-1&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))},t.prototype.get=function(t){var e=this.store.get(t);return this.stashOldValue(t,e),e},t.prototype.put=function(t,e,n){return this.markModified(t),this.store.put(t,e,n)},t.prototype["delete"]=function(t){this.markModified(t),this.store["delete"](t)},t.prototype.commit=function(){},t.prototype.abort=function(){var t,e,n;for(t=0;t<this.modifiedKeys.length;t++)e=this.modifiedKeys[t],n=this.originalData[e],null===n?this.store["delete"](e):this.store.put(e,n,!0)},t}();n.SimpleSyncRWTransaction=w;var v=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return s(e,t),e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(p.PreloadFile);n.SyncKeyValueFile=v;var E=function(t){function e(e){t.call(this),this.store=e.store,this.makeRootDirectory()}return s(e,t),e.isAvailable=function(){return!0},e.prototype.getName=function(){return this.store.name()},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.makeRootDirectory=function(){var t=this.store.beginTransaction("readwrite");if(void 0===t.get(d)){var e=(new Date).getTime(),n=new h(r(),4096,511|c.FileType.DIRECTORY,e,e,e);t.put(n.id,new g("{}"),!1),t.put(d,n.toBuffer(),!1),t.commit()}},e.prototype._findINode=function(t,e,n){var r=this,i=function(i){var o=r.getDirListing(t,e,i);if(o[n])return o[n];throw y.ENOENT(f.resolve(e,n))};return"/"===e?""===n?d:i(this.getINode(t,e,d)):i(this.getINode(t,e+f.sep+n,this._findINode(t,f.dirname(e),f.basename(e))))},e.prototype.findINode=function(t,e){return this.getINode(t,e,this._findINode(t,f.dirname(e),f.basename(e)))},e.prototype.getINode=function(t,e,n){var r=t.get(n);if(void 0===r)throw y.ENOENT(e);return h.fromBuffer(r)},e.prototype.getDirListing=function(t,e,n){if(!n.isDirectory())throw y.ENOTDIR(e);var r=t.get(n.id);if(void 0===r)throw y.ENOENT(e);return JSON.parse(r.toString())},e.prototype.addNewNode=function(t,e){for(var n,i=0;i<5;)try{return n=r(),t.put(n,e,!1),n}catch(o){}throw new y(u.ErrorCode.EIO,"Unable to commit data to key-value store.")},e.prototype.commitNewFile=function(t,e,n,r,i){var o=f.dirname(e),s=f.basename(e),a=this.findINode(t,o),u=this.getDirListing(t,o,a),c=(new Date).getTime();if("/"===e)throw y.EEXIST(e);if(u[s])throw y.EEXIST(e);try{var l=this.addNewNode(t,i),p=new h(l,i.length,r|n,c,c,c),d=this.addNewNode(t,p.toBuffer());u[s]=d,t.put(a.id,new g(JSON.stringify(u)),!0)}catch(w){throw t.abort(),w}return t.commit(),p},e.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},e.prototype.renameSync=function(t,e){var n=this.store.beginTransaction("readwrite"),r=f.dirname(t),i=f.basename(t),o=f.dirname(e),s=f.basename(e),a=this.findINode(n,r),c=this.getDirListing(n,r,a);if(!c[i])throw y.ENOENT(t);var h=c[i];if(delete c[i],0===(o+"/").indexOf(t+"/"))throw new y(u.ErrorCode.EBUSY,r);var l,p;if(o===r?(l=a,p=c):(l=this.findINode(n,o),p=this.getDirListing(n,o,l)),p[s]){var d=this.getINode(n,e,p[s]);if(!d.isFile())throw y.EPERM(e);try{n["delete"](d.id),n["delete"](p[s])}catch(w){throw n.abort(),w}}p[s]=h;try{n.put(a.id,new g(JSON.stringify(c)),!0),n.put(l.id,new g(JSON.stringify(p)),!0)}catch(w){throw n.abort(),w}n.commit()},e.prototype.statSync=function(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()},e.prototype.createFileSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=new g(0),o=this.commitNewFile(r,t,c.FileType.FILE,n,i);return new v(this,t,e,o.toStats(),i)},e.prototype.openFileSync=function(t,e){var n=this.store.beginTransaction("readonly"),r=this.findINode(n,t),i=n.get(r.id);if(void 0===i)throw y.ENOENT(t);return new v(this,t,e,r.toStats(),i)},e.prototype.removeEntry=function(t,e){var n=this.store.beginTransaction("readwrite"),r=f.dirname(t),i=this.findINode(n,r),o=this.getDirListing(n,r,i),s=f.basename(t);if(!o[s])throw y.ENOENT(t);var a=o[s];delete o[s];var u=this.getINode(n,t,a);if(!e&&u.isDirectory())throw y.EISDIR(t);if(e&&!u.isDirectory())throw y.ENOTDIR(t);try{n["delete"](u.id),n["delete"](a),n.put(i.id,new g(JSON.stringify(o)),!0)}catch(c){throw n.abort(),c}n.commit()},e.prototype.unlinkSync=function(t){this.removeEntry(t,!1)},e.prototype.rmdirSync=function(t){this.removeEntry(t,!0)},e.prototype.mkdirSync=function(t,e){var n=this.store.beginTransaction("readwrite"),r=new g("{}");this.commitNewFile(n,t,c.FileType.DIRECTORY,e,r)},e.prototype.readdirSync=function(t){var e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))},e.prototype._syncSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=this._findINode(r,f.dirname(t),f.basename(t)),o=this.getINode(r,t,i),s=o.update(n);try{r.put(o.id,e,!0),s&&r.put(i,o.toBuffer(),!0)}catch(a){throw r.abort(),a}r.commit()},e}(a.SynchronousFileSystem);n.SyncKeyValueFileSystem=E;var m=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return s(e,t),e.prototype.sync=function(t){var e=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(n){n||e.resetDirty(),t(n)}):t()},e.prototype.close=function(t){this.sync(t)},e}(p.PreloadFile);n.AsyncKeyValueFile=m;var S=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.init=function(t,e){this.store=t,this.makeRootDirectory(e)},e.isAvailable=function(){return!0},e.prototype.getName=function(){return this.store.name()},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.makeRootDirectory=function(t){var e=this.store.beginTransaction("readwrite");e.get(d,function(n,i){if(n||void 0===i){var s=(new Date).getTime(),a=new h(r(),4096,511|c.FileType.DIRECTORY,s,s,s);e.put(a.id,new g("{}"),!1,function(n){
o(n,e,t)&&e.put(d,a.toBuffer(),!1,function(n){n?e.abort(function(){t(n)}):e.commit(t)})})}else e.commit(t)})},e.prototype._findINode=function(t,e,n,r){var o=this,s=function(t,i,o){t?r(t):o[n]?r(null,o[n]):r(y.ENOENT(f.resolve(e,n)))};"/"===e?""===n?r(null,d):this.getINode(t,e,d,function(n,a){i(n,r)&&o.getDirListing(t,e,a,function(t,e){s(t,a,e)})}):this.findINodeAndDirListing(t,e,s)},e.prototype.findINode=function(t,e,n){var r=this;this._findINode(t,f.dirname(e),f.basename(e),function(o,s){i(o,n)&&r.getINode(t,e,s,n)})},e.prototype.getINode=function(t,e,n,r){t.get(n,function(t,n){i(t,r)&&(void 0===n?r(y.ENOENT(e)):r(null,h.fromBuffer(n)))})},e.prototype.getDirListing=function(t,e,n,r){n.isDirectory()?t.get(n.id,function(t,n){if(i(t,r))try{r(null,JSON.parse(n.toString()))}catch(t){r(y.ENOENT(e))}}):r(y.ENOTDIR(e))},e.prototype.findINodeAndDirListing=function(t,e,n){var r=this;this.findINode(t,e,function(o,s){i(o,n)&&r.getDirListing(t,e,s,function(t,e){i(t,n)&&n(null,s,e)})})},e.prototype.addNewNode=function(t,e,n){var i,o=0,s=function(){5===++o?n(new y(u.ErrorCode.EIO,"Unable to commit data to key-value store.")):(i=r(),t.put(i,e,!1,function(t,e){t||!e?s():n(null,i)}))};s()},e.prototype.commitNewFile=function(t,e,n,r,i,s){var a=this,u=f.dirname(e),c=f.basename(e),l=(new Date).getTime();return"/"===e?s(y.EEXIST(e)):void this.findINodeAndDirListing(t,u,function(u,f,p){o(u,t,s)&&(p[c]?t.abort(function(){s(y.EEXIST(e))}):a.addNewNode(t,i,function(e,u){if(o(e,t,s)){var d=new h(u,i.length,r|n,l,l,l);a.addNewNode(t,d.toBuffer(),function(e,n){o(e,t,s)&&(p[c]=n,t.put(f.id,new g(JSON.stringify(p)),!0,function(e){o(e,t,s)&&t.commit(function(e){o(e,t,s)&&s(null,d)})}))})}}))})},e.prototype.empty=function(t){var e=this;this.store.clear(function(n){i(n,t)&&e.makeRootDirectory(t)})},e.prototype.rename=function(t,e,n){var r=this,i=this.store.beginTransaction("readwrite"),s=f.dirname(t),a=f.basename(t),c=f.dirname(e),h=f.basename(e),l={},p={},d=!1;if(0===(c+"/").indexOf(t+"/"))return n(new y(u.ErrorCode.EBUSY,s));var w=function(){if(!d&&p.hasOwnProperty(s)&&p.hasOwnProperty(c)){var u=p[s],f=l[s],w=p[c],v=l[c];if(u[a]){var E=u[a];delete u[a];var m=function(){w[h]=E,i.put(f.id,new g(JSON.stringify(u)),!0,function(t){o(t,i,n)&&(s===c?i.commit(n):i.put(v.id,new g(JSON.stringify(w)),!0,function(t){o(t,i,n)&&i.commit(n)}))})};w[h]?r.getINode(i,e,w[h],function(t,r){o(t,i,n)&&(r.isFile()?i["delete"](r.id,function(t){o(t,i,n)&&i["delete"](w[h],function(t){o(t,i,n)&&m()})}):i.abort(function(t){n(y.EPERM(e))}))}):m()}else n(y.ENOENT(t))}},v=function(t){r.findINodeAndDirListing(i,t,function(e,r,o){e?d||(d=!0,i.abort(function(){n(e)})):(l[t]=r,p[t]=o,w())})};v(s),s!==c&&v(c)},e.prototype.stat=function(t,e,n){var r=this.store.beginTransaction("readonly");this.findINode(r,t,function(t,e){i(t,n)&&n(null,e.toStats())})},e.prototype.createFile=function(t,e,n,r){var o=this,s=this.store.beginTransaction("readwrite"),a=new g(0);this.commitNewFile(s,t,c.FileType.FILE,n,a,function(n,s){i(n,r)&&r(null,new m(o,t,e,s.toStats(),a))})},e.prototype.openFile=function(t,e,n){var r=this,o=this.store.beginTransaction("readonly");this.findINode(o,t,function(s,a){i(s,n)&&o.get(a.id,function(o,s){i(o,n)&&(void 0===s?n(y.ENOENT(t)):n(null,new m(r,t,e,a.toStats(),s)))})})},e.prototype.removeEntry=function(t,e,n){var r=this,i=this.store.beginTransaction("readwrite"),s=f.dirname(t),a=f.basename(t);this.findINodeAndDirListing(i,s,function(s,u,c){if(o(s,i,n))if(c[a]){var f=c[a];delete c[a],r.getINode(i,t,f,function(r,s){o(r,i,n)&&(!e&&s.isDirectory()?i.abort(function(){n(y.EISDIR(t))}):e&&!s.isDirectory()?i.abort(function(){n(y.ENOTDIR(t))}):i["delete"](s.id,function(t){o(t,i,n)&&i["delete"](f,function(t){o(t,i,n)&&i.put(u.id,new g(JSON.stringify(c)),!0,function(t){o(t,i,n)&&i.commit(n)})})}))})}else i.abort(function(){n(y.ENOENT(t))})})},e.prototype.unlink=function(t,e){this.removeEntry(t,!1,e)},e.prototype.rmdir=function(t,e){this.removeEntry(t,!0,e)},e.prototype.mkdir=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=new g("{}");this.commitNewFile(r,t,c.FileType.DIRECTORY,e,i,n)},e.prototype.readdir=function(t,e){var n=this,r=this.store.beginTransaction("readonly");this.findINode(r,t,function(o,s){i(o,e)&&n.getDirListing(r,t,s,function(t,n){i(t,e)&&e(null,Object.keys(n))})})},e.prototype._sync=function(t,e,n,r){var i=this,s=this.store.beginTransaction("readwrite");this._findINode(s,f.dirname(t),f.basename(t),function(a,u){o(a,s,r)&&i.getINode(s,t,u,function(t,i){if(o(t,s,r)){var a=i.update(n);s.put(i.id,e,!0,function(t){o(t,s,r)&&(a?s.put(u,i.toBuffer(),!0,function(t){o(t,s,r)&&s.commit(r)}):s.commit(r))})}})})},e}(a.BaseFileSystem);n.AsyncKeyValueFileSystem=S},{"../core/api_error":13,"../core/buffer":15,"../core/file_system":22,"../core/node_fs_stats":25,"../core/node_path":26,"../generic/inode":31,"../generic/preload_file":33}],33:[function(t,e,n){var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=t("../core/file"),o=t("../core/buffer"),s=t("../core/api_error"),a=t("../core/node_fs"),u=s.ApiError,c=s.ErrorCode,f=o.Buffer,h=function(t){function e(e,n,r,i,o){if(t.call(this),this._pos=0,this._dirty=!1,this._fs=e,this._path=n,this._flag=r,this._stat=i,null!=o?this._buffer=o:this._buffer=new f(0),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return r(e,t),e.prototype.isDirty=function(){return this._dirty},e.prototype.resetDirty=function(){this._dirty=!1},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStats=function(){return this._stat},e.prototype.getFlag=function(){return this._flag},e.prototype.getPath=function(){return this._path},e.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},e.prototype.advancePos=function(t){return this._pos+=t},e.prototype.setPos=function(t){return this._pos=t},e.prototype.sync=function(t){try{this.syncSync(),t()}catch(e){t(e)}},e.prototype.syncSync=function(){throw new u(c.ENOTSUP)},e.prototype.close=function(t){try{this.closeSync(),t()}catch(e){t(e)}},e.prototype.closeSync=function(){throw new u(c.ENOTSUP)},e.prototype.stat=function(t){try{t(null,this._stat.clone())}catch(e){t(e)}},e.prototype.statSync=function(){return this._stat.clone()},e.prototype.truncate=function(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!a.fs.getRootFS().supportsSynch()&&this.sync(e),e()}catch(n){return e(n)}},e.prototype.truncateSync=function(t){if(this._dirty=!0,!this._flag.isWriteable())throw new u(c.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,t>this._buffer.length){var e=new f(t-this._buffer.length);return e.fill(0),this.writeSync(e,0,e.length,this._buffer.length),void(this._flag.isSynchronous()&&a.fs.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=t;var n=new f(t);this._buffer.copy(n,0,0,t),this._buffer=n,this._flag.isSynchronous()&&a.fs.getRootFS().supportsSynch()&&this.syncSync()},e.prototype.write=function(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(o){i(o)}},e.prototype.writeSync=function(t,e,n,r){if(this._dirty=!0,null==r&&(r=this.getPos()),!this._flag.isWriteable())throw new u(c.EPERM,"File not opened with a writeable mode.");var i=r+n;if(i>this._stat.size&&(this._stat.size=i,i>this._buffer.length)){var o=new f(i);this._buffer.copy(o),this._buffer=o}var s=t.copy(this._buffer,r,e,e+n);return this._stat.mtime=new Date,this._flag.isSynchronous()?(this.syncSync(),s):(this.setPos(r+s),s)},e.prototype.read=function(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(o){i(o)}},e.prototype.readSync=function(t,e,n,r){if(!this._flag.isReadable())throw new u(c.EPERM,"File not opened with a readable mode.");null==r&&(r=this.getPos());var i=r+n;i>this._stat.size&&(n=this._stat.size-r);var o=this._buffer.copy(t,e,r,r+n);return this._stat.atime=new Date,this._pos=r+n,o},e.prototype.chmod=function(t,e){try{this.chmodSync(t),e()}catch(n){e(n)}},e.prototype.chmodSync=function(t){if(!this._fs.supportsProps())throw new u(c.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()},e}(i.BaseFile);n.PreloadFile=h;var l=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return r(e,t),e.prototype.sync=function(t){t()},e.prototype.syncSync=function(){},e.prototype.close=function(t){t()},e.prototype.closeSync=function(){},e}(h);n.NoSyncFile=l},{"../core/api_error":13,"../core/buffer":15,"../core/file":20,"../core/node_fs":24}],34:[function(t,e,n){function r(t){for(var e=IEBinaryToArray_ByteStr(t),n=IEBinaryToArray_ByteStr_Last(t),r=e.replace(/[\s\S]/g,function(t){var e=t.charCodeAt(0);return String.fromCharCode(255&e,e>>8)})+n,i=new Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return i}function i(t,e,n,i){switch(n){case"buffer":case"json":break;default:return i(new g(w.EINVAL,"Invalid download type: "+n))}var o=new XMLHttpRequest;o.open("GET",e,t),o.setRequestHeader("Accept-Charset","x-user-defined"),o.onreadystatechange=function(t){var e;if(4===o.readyState){if(200!==o.status)return i(new g(o.status,"XHR error."));switch(n){case"buffer":return e=r(o.responseBody),i(null,new v(e));case"json":return i(null,JSON.parse(o.responseText))}}},o.send()}function o(t,e,n){i(!0,t,e,n)}function s(t,e){var n;return i(!1,t,e,function(t,e){if(t)throw t;n=e}),n}function a(t,e,n){var r=new XMLHttpRequest;r.open("GET",t,!0);var i=!0;switch(e){case"buffer":r.responseType="arraybuffer";break;case"json":try{r.responseType="json",i="json"===r.responseType}catch(o){i=!1}break;default:return n(new g(w.EINVAL,"Invalid download type: "+e))}r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new g(r.status,"XHR error."));switch(e){case"buffer":return n(null,new v(r.response?r.response:0));case"json":return i?n(null,r.response):n(null,JSON.parse(r.responseText))}}},r.send()}function u(t,e){var n=new XMLHttpRequest;n.open("GET",t,!1);var r=null,i=null;if(n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(t){if(4===n.readyState){if(200!==n.status)return void(i=new g(n.status,"XHR error."));switch(e){case"buffer":var o=n.responseText;r=new v(o.length);for(var s=0;s<o.length;s++)r.writeUInt8(o.charCodeAt(s),s);return;case"json":return void(r=JSON.parse(n.responseText))}}},n.send(),i)throw i;return r}function c(t,e){var n=new XMLHttpRequest;switch(n.open("GET",t,!1),e){case"buffer":n.responseType="arraybuffer";break;case"json":break;default:throw new g(w.EINVAL,"Invalid download type: "+e)}var r,i;if(n.onreadystatechange=function(t){if(4===n.readyState)if(200===n.status)switch(e){case"buffer":r=new v(n.response);break;case"json":r=JSON.parse(n.response)}else i=new g(n.status,"XHR error.")},n.send(),i)throw i;return r}function f(t,e,n){var r=new XMLHttpRequest;r.open("HEAD",e,t),r.onreadystatechange=function(t){if(4===r.readyState){if(200!=r.status)return n(new g(r.status,"XHR HEAD error."));try{return n(null,parseInt(r.getResponseHeader("Content-Length"),10))}catch(t){return n(new g(w.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}function h(t){var e;return f(!1,t,function(t,n){if(t)throw t;e=n}),e}function l(t,e){f(!0,t,e)}var p=t("../core/util"),d=t("../core/buffer"),y=t("../core/api_error"),g=y.ApiError,w=y.ErrorCode,v=d.Buffer;n.asyncDownloadFile=p.isIE&&"undefined"==typeof Blob?o:a,n.syncDownloadFile=p.isIE&&"undefined"==typeof Blob?s:p.isIE&&"undefined"!=typeof Blob?c:u,n.getFileSizeSync=h,n.getFileSizeAsync=l},{"../core/api_error":13,"../core/buffer":15,"../core/util":29}],35:[function(t,e,n){"use strict";function r(t,e,n){return[void 0,null]}function i(t,e){return[null,void 0,null]}function o(t,e,r){var i=r.getTime(),o=Math.floor(i/1e3),s={sec:o,nsec:1e6*(i-1e3*o)};return f.Marshal(t,e,s,n.TimespecDef)}function s(t,e){var r={},i=f.Unmarshal(r,t,e,n.TimespecDef),o=i[0],s=i[1],a=r.sec,u=r.nsec;return[new Date(1e3*a+u/1e6),o,s]}function a(t){return 8-(t+3)%8}function u(t,e,n){if("string"!=typeof n)return[void 0,new Error("src not a string: "+n)];var r=h.utf8ToBytes(n),i=a(r.length);if(e+r.length+i>t.byteLength)return[void 0,new Error("dst not big enough")];for(var o=0;o<r.length;o++)t.setUint8(e+o,r[o]);for(var o=0;o<i;o++)t.setUint8(e+r.length+o,0);return[r.length+i,null]}function c(t,e){for(var n=0,r=e;r<t.byteLength&&0!==t.getUint8(r);r++)n++;var i=h.utf8Slice(t,e,e+n),o=a(n);return[i,n+o,null]}var f=t("./marshal"),h=t("./utf8");n.TimespecDef={fields:[{name:"sec",type:"int64"},{name:"nsec",type:"int64"}],alignment:"natural",length:16},n.TimevalDef=n.TimespecDef,n.StatDef={fields:[{name:"dev",type:"uint64"},{name:"ino",type:"uint64"},{name:"nlink",type:"uint64"},{name:"mode",type:"uint32"},{name:"uid",type:"uint32"},{name:"gid",type:"uint32"},{name:"X__pad0",type:"int32",marshal:r,unmarshal:i,omit:!0},{name:"rdev",type:"uint64"},{name:"size",type:"int64"},{name:"blksize",type:"int64"},{name:"blocks",type:"int64"},{name:"atime",type:"Timespec",count:2,marshal:o,unmarshal:s},{name:"mtime",type:"Timespec",count:2,marshal:o,unmarshal:s},{name:"ctime",type:"Timespec",count:2,marshal:o,unmarshal:s},{name:"X__unused",type:"int64",count:3,marshal:r,unmarshal:i,omit:!0}],alignment:"natural",length:144},function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.FIFO=1]="FIFO",t[t.CHR=2]="CHR",t[t.DIR=4]="DIR",t[t.BLK=6]="BLK",t[t.REG=8]="REG",t[t.LNK=10]="LNK",t[t.SOCK=12]="SOCK",t[t.WHT=14]="WHT"}(n.DT||(n.DT={}));var l=(n.DT,function(){function t(t,e,n){this.ino=t,this.type=e,this.name=n}return Object.defineProperty(t.prototype,"off",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reclen",{get:function(){var t=h.utf8ToBytes(this.name).length,e=a(t);return t+e+1+2+8+8},enumerable:!0,configurable:!0}),t}());n.Dirent=l,n.DirentDef={fields:[{name:"ino",type:"uint64"},{name:"off",type:"int64"},{name:"reclen",type:"uint16"},{name:"type",type:"uint8"},{name:"name",type:"string",marshal:u,unmarshal:c}],alignment:"natural"}},{"./marshal":37,"./utf8":39}],36:[function(t,e,n){"use strict";var r=t("./marshal"),i=t("./socket"),o=t("./fs");n.Marshal=r.Marshal,n.Unmarshal=r.Unmarshal,n.socket=i,n.fs=o},{"./fs":35,"./marshal":37,"./socket":38}],37:[function(t,e,n){"use strict";function r(t){switch(t){case"uint8":case"int8":return 1;case"uint16":case"int16":return 2;case"uint32":case"int32":return 4;case"uint64":case"int64":return 8;case"float32":return 4;case"float64":return 8;default:return console.log("unknown type"),void console.log(t)}}function i(t){var e=r(t.type);return e*(t.count?t.count:1)}function o(t,e,n,r){if(!t||!n||!r)return[0,new Error("missing required inputs")];for(var o=e,s=u,a=0;a<r.fields.length;a++){var c=r.fields[a],f=n[c.name],h=void 0,l=void 0;if(c.marshal?(p=c.marshal(t,e,f),h=p[0],l=p[1]):(d=s[c.type](t,e,f),h=d[0],l=d[1]),l)return[e-o,l];void 0===h&&(h=i(c)),e+=h}return[e-o,null];var p,d}function s(t,e,n,r){if(!e||!r)return[0,new Error("missing required inputs")];for(var o=n,s=c,a=0;a<r.fields.length;a++){var u=r.fields[a],f=void 0,h=void 0,l=void 0;if(u.unmarshal?(p=u.unmarshal(e,n),f=p[0],h=p[1],l=p[2]):(d=s[u.type](e,n),f=d[0],h=d[1],l=d[2]),l)return[n-o,l];u.omit||(t[u.name]=f),void 0===h&&(h=i(u)),n+=h}return[n-o,null];var p,d}function a(t){for(var e=0;e<t.byteLength;e++)if(0!==t.getUint8(e))return!1;return!0}var u={uint8:function(t,e,n){return n>>>=0,t.setUint8(e,n),[1,null]},uint16:function(t,e,n){return n>>>=0,t.setUint16(e,n,!0),[2,null]},uint32:function(t,e,n){return n>>>=0,t.setUint32(e,n,!0),[4,null]},uint64:function(t,e,n){var r=n>>>0,i=n/4294967296>>>0;return t.setUint32(e,r,!0),t.setUint32(e+4,i,!0),[8,null]},int8:function(t,e,n){return n=0|n,t.setInt8(e,n),[1,null]},int16:function(t,e,n){return n=0|n,t.setInt16(e,n,!0),[2,null]},int32:function(t,e,n){return n=0|n,t.setInt32(e,n,!0),[4,null]},int64:function(t,e,n){var r=0|n,i=n/4294967296|0;return t.setInt32(e,r,!0),t.setInt32(e+4,i,!0),[8,null]}},c={uint8:function(t,e){var n=t.getUint8(e)>>>0;return[n,1,null]},uint16:function(t,e){var n=t.getUint16(e,!0)>>>0;return[n,2,null]},uint32:function(t,e){var n=t.getUint32(e,!0)>>>0;return[n,4,null]},uint64:function(t,e){var n=t.getUint32(e,!0),r=t.getUint32(e+4,!0);return 0!==r&&(r*=4294967296),[n+r,8,null]},int8:function(t,e){var n=0|t.getInt8(e);return[n,1,null]},int16:function(t,e){var n=0|t.getInt16(e,!0);return[n,2,null]},int32:function(t,e){var n=0|t.getInt32(e,!0);return[n,4,null]},int64:function(t,e){var n=t.getInt32(e,!0),r=t.getInt32(e+4,!0);return 0!==r&&(r*=4294967296),[n+r,8,null]}};n.Marshal=o,n.Unmarshal=s,n.isZero=a},{}],38:[function(t,e,n){"use strict";function r(t,e){return e||(e=0),[""+t.getUint8(e+0)+"."+t.getUint8(e+1)+"."+t.getUint8(e+2)+"."+t.getUint8(e+3),4,null]}function i(t,e,n){if(!t||t.byteLength<4)return[void 0,new Error("invalid dst")];t.setUint8(e+0,0),t.setUint8(e+1,0),t.setUint8(e+2,0),t.setUint8(e+3,0);for(var r=e,i=0;i<n.length&&r<e+4;i++)"."!==n[i]?t.setUint8(r,10*t.getUint8(r)+parseInt(n[i],10)):r++;return[4,null]}function o(t,e,n){return!t||t.byteLength<4?[void 0,new Error("invalid dst")]:(t.setUint8(e+0,n>>8&255),t.setUint8(e+1,255&n),[2,null])}function s(t,e){return e||(e=0),[t.getUint8(e+1)+(t.getUint8(e)<<8),2,null]}var a=t("./marshal");n.IPv4BytesToStr=r,n.IPv4StrToBytes=i,n.htons=o,n.ntohs=s,n.SockAddrInDef={fields:[{name:"family",type:"uint16"},{name:"port",type:"uint16",marshal:o,unmarshal:s},{name:"addr",type:"uint8",count:4,JSONType:"string",marshal:i,unmarshal:r},{name:"zero",type:"uint8",count:8,ensure:a.isZero,omit:!0}],alignment:"natural",length:16}},{"./marshal":37}],39:[function(t,e,n){"use strict";function r(t,e,n){n=Math.min(t.byteLength,n);for(var r=[],o=e;o<n;){var s=t.getUint8(o),a=null,u=s>239?4:s>223?3:s>191?2:1;if(o+u<=n){var c=void 0,f=void 0,h=void 0,l=void 0;switch(u){case 1:s<128&&(a=s);break;case 2:c=t.getUint8(o+1),128===(192&c)&&(l=(31&s)<<6|63&c,l>127&&(a=l));break;case 3:c=t.getUint8(o+1),f=t.getUint8(o+2),128===(192&c)&&128===(192&f)&&(l=(15&s)<<12|(63&c)<<6|63&f,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:c=t.getUint8(o+1),f=t.getUint8(o+2),h=t.getUint8(o+3),128===(192&c)&&128===(192&f)&&128===(192&h)&&(l=(15&s)<<18|(63&c)<<12|(63&f)<<6|63&h,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,u=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),o+=u}return i(r)}function i(t){var e=t.length;if(e<=s)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=s));return n}function o(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],s=0;s<r;s++){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}n.kMaxLength=1073741823,n.utf8Slice=r;var s=4096;n.utf8ToBytes=o},{}]},{},[5]);