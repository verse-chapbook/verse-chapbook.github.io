"use strict";!function(e,t,n,o){e(".inputfile").each(function(){var t=e(this),n=t.find("input"),o=t.find("label"),i=t.find("span"),a=o.html();n.on("change",function(e){var t="";this.files&&this.files.length>1?t=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(t=e.target.value.split("\\").pop()),t?i.html(t):o.html(a)}),n.on("focus",function(){n.addClass("has-focus")}).on("blur",function(){n.removeClass("has-focus")})})}(jQuery,window,document),Raven.config("https://967b002cd9b849f795b5d1d7dcc50c7e@sentry.io/243389",{environment:CHAPBOOK_CONFIG.env,shouldSendCallback:function(){return"production"===CHAPBOOK_CONFIG.env},debug:"development"===CHAPBOOK_CONFIG.env}).install(),Raven.context(function(){function e(e){I=e,$(".chapbook-step").each(function(){var e=$(this),t=e.data("num"),n=e.find(".chapbook-step-content"),o=e.find(".chapbook-step-success");e.removeClass("text-disabled text-muted"),n.hide(),o.hide(),I===t?n.show():I<t?e.addClass("text-muted"):(e.addClass("text-disabled"),o.show())})}function t(){u&&"undefined"!=typeof SharedArrayBuffer||$("#sab-alert").removeClass("browsix-hidden"),$("#loading").removeClass("browsix-hidden"),window.Boot("XmlHttpRequest",["index.json","fs",!0],function(e,t){if(e)throw console.log(e),new Error(e);E=t,o()})}function n(){k&&(B||v.value)&&(p.disabled=!1)}function o(){$("#loading").addClass("browsix-hidden"),k=!0,n()}function i(e){console.log("progress",e),$("#build-bar").css("width",""+Math.min(95*e/100+5,100)+"%").attr("aria-valuenow",e).html(""+e+"%")}function a(){var e=f+".pdf",t=new Uint8Array(E.fs.readFileSync(e).data.buff.buffer),n=new Blob([t],{type:"application/pdf"}),o=window.URL.createObjectURL(n),i=document.createElement("embed");i.className="pdf",i.src=o,i.setAttribute("alt",f+".pdf"),i.setAttribute("pluginspage","http://www.adobe.com/products/acrobat/readstep2.html"),console.log(o),$(w).attr("href",o).off("click").click(function(e){e.preventDefault(),download(n,"chapbook.pdf")}),g.innerHTML="",g.appendChild(i),$(p).removeClass("is-active").blur()}function d(){function t(e,t){s+=t}function n(e,t){s+=t}function o(l,u){if(0!==u)return Raven.captureException(new Error("Chapbook creation failed"),{extra:{log:s}}),$(y).show(),$(x).hide(),e(3),void $(p).removeClass("is-active").blur();i(r),r+=25,s="";var f=c.shift();if(console.log(f),!f){a(),r=100,i(r);var m=""+(performance.now()-d)/1e3,h=m.indexOf(".");return h+2<m.length&&(m=m.substr(0,h+2)),$("#timing").removeClass("browsix-hidden"),C.innerHTML=m,void e(3)}var v=["pdfpages","koma-script","graphics","base","tools","eso-pic","graphics-cfg","pdftex-def","oberdiek"].map(function(e){return"usr/share/texmf-dist/tex/latex/"+e}),b=["oberdiek","ifxetex"].map(function(e){return"usr/share/texmf-dist/tex/generic/"+e}),g=["."].concat(v).concat(b);E.system(f,o,t,n,["TEXINPUTS="+g.join(":")])}var d=performance.now(),r=10;$("#timing").addClass("browsix-hidden"),C.innerHTML="",g.innerHTML="<center><b>PDF will appear here when built</b></center>";var s="",c=A.slice();o(-1,0)}function r(e){$(p).toggleClass("is-active").blur(),e()}function s(){E.fs.writeFile("document.pdf",E.fs.readFileSync("example.pdf","binary"),"binary",function(){d()})}function c(){if(e(2),B)return void s();var t=v.files[0];if(!t||"application/pdf"!==t.type)return alert("Must upload a .pdf file"),void $(p).removeClass("is-active").blur();var n=new FileReader;n.onload=function(e){var t=e.target.result;E.fs.writeFile("document.pdf",t,"binary",function(){d()})},n.readAsBinaryString(t)}var l="-halt-on-error -interaction nonstopmode --shell-escape ",u="undefined"!=typeof navigator&&navigator.userAgent.match(/Chrome/)&&!navigator.userAgent.match(/Edge/),f=("undefined"!=typeof navigator&&navigator.userAgent.match(/Firefox/),"chapbook"),p=document.getElementById("create-upload-button"),m=document.getElementById("use-example-button"),h=document.getElementById("start-over-button"),v=document.getElementById("pdf-upload"),b=document.getElementById("pdf-upload-name"),g=(document.getElementById("loading"),document.getElementById("pdf-parent")),w=document.getElementById("pdf-download"),x=document.getElementById("pdf-success"),y=document.getElementById("pdf-error"),C=document.getElementById("perf-out"),E=null,B=!1,k=!1,I=1;window.location.search.indexOf("test=1")>=0&&$(m).show();var A=["pdflatex "+l+f+".tex"];p.addEventListener("click",function(){r(c)}),v.addEventListener("change",function(){B=!1,n()}),m.addEventListener("click",function(){B=!0,$(b).html("example.pdf"),n()}),h.addEventListener("click",function(){$(v).val(""),$(b).text(""),p.disabled=!0,i(0),e(1)}),t()});